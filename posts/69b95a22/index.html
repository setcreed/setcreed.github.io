<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>python总结 | 伊甸园</title><meta name="author" content="SetCreed"><meta name="copyright" content="SetCreed"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Python语言基础python语言特性 动态强类型语言(不少人误以为是弱类型) 动态还是静态指的是编译期还是运行期确定类型 强类型指的是不会发生隐式类型转换  鸭子类型当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称为鸭子。  关注点在对象的行为，而不是类型(duck typing) 比如 file,StringIO,socket 对象都支持read&#x2F;write方法">
<meta property="og:type" content="article">
<meta property="og:title" content="python总结">
<meta property="og:url" content="https://setcreed.github.io/posts/69b95a22/index.html">
<meta property="og:site_name" content="伊甸园">
<meta property="og:description" content="Python语言基础python语言特性 动态强类型语言(不少人误以为是弱类型) 动态还是静态指的是编译期还是运行期确定类型 强类型指的是不会发生隐式类型转换  鸭子类型当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称为鸭子。  关注点在对象的行为，而不是类型(duck typing) 比如 file,StringIO,socket 对象都支持read&#x2F;write方法">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://setcreed.oss-cn-shanghai.aliyuncs.com/images/material-1.png">
<meta property="article:published_time" content="2022-03-03T15:58:52.000Z">
<meta property="article:modified_time" content="2022-03-03T15:58:52.000Z">
<meta property="article:author" content="SetCreed">
<meta property="article:tag" content="hexo、code、dream">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://setcreed.oss-cn-shanghai.aliyuncs.com/images/material-1.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://setcreed.github.io/posts/69b95a22/index.html"><link rel="preconnect" href="//unpkg.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://unpkg.com/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"距离上次更新已经过了","messageNext":"天，文章所描述的内容可能已经发生变化，请留意。"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://unpkg.com/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'python总结',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-03 23:58:52'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/custom/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/custom/icon.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="伊甸园" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">89</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">27</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/cloudnative/"><i class="fa-fw fas fa-cloud"></i><span> 云原生</span></a></li><li><a class="site-page child" href="/golang/"><i class="fa-fw fa-brands fa-golang"></i><span> Golang编程</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 读书</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://setcreed.oss-cn-shanghai.aliyuncs.com/images/material-1.png')"><nav id="nav"><span id="blog-info"><a href="/" title="伊甸园"><span class="site-name">伊甸园</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/cloudnative/"><i class="fa-fw fas fa-cloud"></i><span> 云原生</span></a></li><li><a class="site-page child" href="/golang/"><i class="fa-fw fa-brands fa-golang"></i><span> Golang编程</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 读书</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">python总结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-03T15:58:52.000Z" title="发表于 2022-03-03 23:58:52">2022-03-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-03T15:58:52.000Z" title="更新于 2022-03-03 23:58:52">2022-03-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">16.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>62分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="python总结"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Python语言基础"><a href="#Python语言基础" class="headerlink" title="Python语言基础"></a>Python语言基础</h2><h3 id="python语言特性"><a href="#python语言特性" class="headerlink" title="python语言特性"></a>python语言特性</h3><ul>
<li>动态强类型语言(不少人误以为是弱类型)</li>
<li>动态还是静态指的是编译期还是运行期确定类型</li>
<li>强类型指的是不会发生隐式类型转换</li>
</ul>
<h3 id="鸭子类型"><a href="#鸭子类型" class="headerlink" title="鸭子类型"></a>鸭子类型</h3><p>当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称为鸭子。</p>
<ul>
<li>关注点在对象的行为，而不是类型(duck typing)</li>
<li>比如 file,StringIO,socket 对象都支持read/write方法(file like object)</li>
<li>再比如定义了<code>__iter__</code>魔术方法的对象可以用 for 迭代</li>
</ul>
<h3 id="python2与3的差异"><a href="#python2与3的差异" class="headerlink" title="python2与3的差异"></a>python2与3的差异</h3><ul>
<li>python3 中print 成为函数</li>
<li>编码问题，python3中str默认就是unicode</li>
<li>Python3 除号返回浮点数</li>
<li>优化的 super() 方便直接调用父类函数</li>
<li>python3新增的：<ul>
<li>yield from 链接子生成器</li>
<li>asyncio内置库，async/await 原生协程支持异步编程</li>
</ul>
</li>
<li>python3改进的：<ul>
<li>一些内置库的修改。urllib, selector 等</li>
<li>生成的 pyc 文件统一放到 <code>__pycache__</code></li>
</ul>
</li>
</ul>
<h3 id="monkey-patch"><a href="#monkey-patch" class="headerlink" title="monkey patch"></a>monkey patch</h3><ul>
<li>所谓的 monkey patch 就是运行时替换</li>
<li>比如 gevent 库需要修改内置的 socket</li>
<li>from gevent import monkey; monkey.patch_socket()</li>
</ul>
<h3 id="自省Introspection"><a href="#自省Introspection" class="headerlink" title="自省Introspection"></a>自省Introspection</h3><ul>
<li>运行时判断一个对象的类型的能力</li>
<li>Python一切皆对象，用 type, id, isinstance 获取对象类型信息</li>
<li>Inspect 模块提供了更多获取对象信息的函数</li>
</ul>
<h3 id="python函数"><a href="#python函数" class="headerlink" title="python函数"></a>python函数</h3><p>可变类型作为参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">flist</span>(<span class="params">lt</span>):</span><br><span class="line">    lt.append(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(lt)</span><br><span class="line">    </span><br><span class="line">lt = []</span><br><span class="line">flist(lt)</span><br><span class="line">flist(lt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果：</span></span><br><span class="line">[<span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>不可变类型作为参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fstr</span>(<span class="params">s</span>):</span><br><span class="line">    s += <span class="string">&quot;a&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    </span><br><span class="line">s = <span class="string">&quot;hehe&quot;</span></span><br><span class="line">fstr(s)</span><br><span class="line">fstr(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果：</span></span><br><span class="line">hehea</span><br><span class="line">hehea</span><br></pre></td></tr></table></figure>
<p>python传递参数：唯一支持的参数传递是共享传参，函数形参获得实参中各个引用的副本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">clear_list</span>(<span class="params">lt</span>):</span><br><span class="line">    lt = []</span><br><span class="line">    </span><br><span class="line">ll = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">clear_list(ll)</span><br><span class="line"><span class="built_in">print</span>(ll)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果：</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p>python可变参数作为默认参数:</p>
<p>默认参数只计算一次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">lt=[<span class="number">1</span>]</span>):</span><br><span class="line">    lt.append(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(lt)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line">func()</span><br><span class="line"><span class="comment"># 输出结果：</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<h3 id="python异常处理"><a href="#python异常处理" class="headerlink" title="python异常处理"></a>python异常处理</h3><p>python异常类</p>
<ul>
<li>BaseException， 最基础的</li>
<li>SystemExit/KeyboardInterrupt/GeneratorExit</li>
<li>Exception   自定义异常类，一般继承这个</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    func()      <span class="comment"># 可能会抛出异常代码</span></span><br><span class="line"><span class="keyword">except</span> (Exception1, Exception2) <span class="keyword">as</span> e:   <span class="comment"># 捕获多个异常并处理</span></span><br><span class="line">    <span class="comment"># 异常处理的代码</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 异常没有发生时的代码逻辑</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># 无论异常有没有发生都会执行的代码。一般处理资源的释放和关闭</span></span><br></pre></td></tr></table></figure>
<h3 id="python性能"><a href="#python性能" class="headerlink" title="python性能"></a>python性能</h3><p>GIL的影响</p>
<ul>
<li>限制了程序的多核执行</li>
<li>同一个时间只能有一个线程执行字节码</li>
<li>CPU密集程序难以利用多核优势</li>
<li>IO期间会释放 GIL，对IO密集程序影响不大</li>
</ul>
<p>为什么有了GIL还要关注线程安全：</p>
<ul>
<li>一个操作如果是一个字节码指令可以完成就是原子的</li>
<li>原子的是可以保证线程安全的</li>
<li>使用 dis 操作来分析字节码</li>
</ul>
<p>dis分析原子操作:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_list</span>(<span class="params">lt</span>):</span><br><span class="line">    lt[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">dis.dis(update_list)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  2           0 LOAD_CONST               1 (1)</span></span><br><span class="line"><span class="string">              2 LOAD_FAST                0 (lt)</span></span><br><span class="line"><span class="string">              4 LOAD_CONST               2 (0)</span></span><br><span class="line"><span class="string">              6 STORE_SUBSCR</span></span><br><span class="line"><span class="string">              8 LOAD_CONST               0 (None)</span></span><br><span class="line"><span class="string">             10 RETURN_VALUE</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>dis分析非原子操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">incr_list</span>(<span class="params">lt</span>):</span><br><span class="line">    lt[<span class="number">0</span>] += <span class="number">1</span>   <span class="comment"># 不是原子操作</span></span><br><span class="line">    </span><br><span class="line">dis.dis(incr_list)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  2           0 LOAD_FAST                0 (lt)</span></span><br><span class="line"><span class="string">              2 LOAD_CONST               1 (0)</span></span><br><span class="line"><span class="string">              4 DUP_TOP_TWO</span></span><br><span class="line"><span class="string">              6 BINARY_SUBSCR</span></span><br><span class="line"><span class="string">              8 LOAD_CONST               2 (1)</span></span><br><span class="line"><span class="string">             10 INPLACE_ADD	   # 需要多个字节码操作，有可能在执行过程中切换到其他线程</span></span><br><span class="line"><span class="string">             12 ROT_THREE</span></span><br><span class="line"><span class="string">             14 STORE_SUBSCR</span></span><br><span class="line"><span class="string">             16 LOAD_CONST               0 (None)</span></span><br><span class="line"><span class="string">             18 RETURN_VALUE</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>剖析程序性能：</p>
<ul>
<li>内置的 profile/cprofile 等工具</li>
<li>使用 pyflame(uber开源)的火焰图工具</li>
</ul>
<p>服务端性能优化措施：</p>
<ul>
<li>数据结构与算法优化</li>
<li>数据库层：索引优化，慢查询消除，批量操作减少IO，NoSQL</li>
<li>网络IO：批量操作，pipeline操作 减少IO</li>
<li>缓存</li>
<li>异步</li>
<li>并发</li>
</ul>
<h3 id="生成器与协程"><a href="#生成器与协程" class="headerlink" title="生成器与协程"></a>生成器与协程</h3><p>生成器：</p>
<ul>
<li>生成器就是可以生成值的函数</li>
<li>当一个函数里有了 yield 关键字就成了生成器</li>
<li>生成器可以挂起执行并且保持当前执行的状态</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">simple_gen</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;hello&quot;</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;world&quot;</span></span><br><span class="line">    </span><br><span class="line">gen = simple_gen()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br></pre></td></tr></table></figure>
<p>基于生成器的协程：</p>
<p>Python3之前没有原生协程，只有基于生成器的协程</p>
<ul>
<li>pep 342(Coroutines via Enhanced Generators)增强生成器功能</li>
<li>生成器可以通过yield暂停执行和产出数据</li>
<li>同时支持send()向生成器发送数据和throw()向生成器抛异常</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">coro</span>():</span><br><span class="line">    hello = <span class="keyword">yield</span> <span class="string">&quot;hello&quot;</span>    <span class="comment"># yield关键字=右边作为表达式，可以被send值</span></span><br><span class="line">    <span class="keyword">yield</span> hello</span><br><span class="line"></span><br><span class="line">c = coro()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(c)) <span class="comment"># 输出hello，这里调用next产出第一个值hello，之后函数暂停</span></span><br><span class="line"><span class="built_in">print</span>(c.send(<span class="string">&quot;world&quot;</span>)) <span class="comment"># 再次调用send发送值，此时hello变量为world，然后yield 产出hello变量的值 world</span></span><br><span class="line"><span class="comment"># 之后协程结束，若再send值会抛出异常StopIteration</span></span><br></pre></td></tr></table></figure>
<p>使用基于生成器的协程 注意点：</p>
<ul>
<li>协程使用需要send(None)或者next(coroutine)来预激，才能启动</li>
<li>在yield处协程会暂停执行</li>
<li>单独的yield value 会产出值给调用方</li>
<li>可以通过coroutine.send(value)来给协程发送值，发送的值会赋值给yield表达式左边的变量</li>
<li>协程执行完成后会抛出StopIteration异常</li>
</ul>
<p>协程装饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 避免每次都要用 send 预激它</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">coroutine</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">primer</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        gen = func(*args, **kwargs)</span><br><span class="line">        <span class="built_in">next</span>(gen)    <span class="comment"># 预激</span></span><br><span class="line">        <span class="keyword">return</span> gen</span><br><span class="line">    <span class="keyword">return</span> primer</span><br></pre></td></tr></table></figure>
<h2 id="python数据结构与算法"><a href="#python数据结构与算法" class="headerlink" title="python数据结构与算法"></a>python数据结构与算法</h2><h3 id="常用的内置算法与数据结构："><a href="#常用的内置算法与数据结构：" class="headerlink" title="常用的内置算法与数据结构："></a>常用的内置算法与数据结构：</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210307134427.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line">Point = collections.namedtuple(<span class="string">&quot;Point&quot;</span>, <span class="string">&#x27;x, y&#x27;</span>)</span><br><span class="line">p = Point(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(p.x)  <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">print</span>(p.y)  <span class="comment"># 2  # namedtuple让 tuple属性变得可读</span></span><br><span class="line"></span><br><span class="line">de = collections.deque()</span><br><span class="line">de.append(<span class="number">1</span>)</span><br><span class="line">de.appendleft(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(de)   <span class="comment"># deque([0, 1])</span></span><br><span class="line">de.pop()</span><br><span class="line">de.popleft()</span><br><span class="line"></span><br><span class="line">c = collections.Counter(<span class="string">&quot;abcabcc&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(c[<span class="string">&#x27;c&#x27;</span>])   <span class="comment"># 3</span></span><br><span class="line"><span class="built_in">print</span>(c.most_common())    <span class="comment"># [(&#x27;c&#x27;, 3), (&#x27;a&#x27;, 2), (&#x27;b&#x27;, 2)]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">od = collections.OrderedDict()</span><br><span class="line">od[<span class="string">&#x27;c&#x27;</span>] = <span class="string">&#x27;c&#x27;</span></span><br><span class="line">od[<span class="string">&#x27;a&#x27;</span>] = <span class="string">&#x27;a&#x27;</span></span><br><span class="line">od[<span class="string">&#x27;b&#x27;</span>] = <span class="string">&#x27;b&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(od.keys()))      <span class="comment"># [&#x27;c&#x27;, &#x27;a&#x27;, &#x27;b&#x27;]  key的顺序</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 带有默认值的字典</span></span><br><span class="line">dd = collections.defaultdict(<span class="built_in">int</span>)</span><br><span class="line"><span class="built_in">print</span>(dd[<span class="string">&#x27;a&#x27;</span>])    <span class="comment"># 0</span></span><br><span class="line">dd[<span class="string">&#x27;b&#x27;</span>] += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(dd)    <span class="comment"># defaultdict(&lt;class &#x27;int&#x27;&gt;, &#123;&#x27;a&#x27;: 0, &#x27;b&#x27;: 1&#125;)</span></span><br></pre></td></tr></table></figure>
<h3 id="python-dict底层结构"><a href="#python-dict底层结构" class="headerlink" title="python dict底层结构"></a>python dict底层结构</h3><p>dict底层使用哈希表</p>
<ul>
<li>为了支持快速查找使用了哈希表作为底层结构</li>
<li>哈希表平均查找时间复杂度O(1)</li>
<li>CPython 解释器使用二次探查解决哈希冲突问题</li>
<li>哈希扩容问题</li>
</ul>
<p>python字典为什么这么快 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42681866/article/details/82785127">https://blog.csdn.net/weixin_42681866/article/details/82785127</a></p>
<p>在Python中，字典是通过散列表（哈希表）实现的。字典也叫哈希数组或关联数组，所以其本质是数组（如下图），每个 bucket 有两部分：一个是键对象的引用，一个是值对象的引用。所有 bucket 结构和大小一致，我们可以通过偏移量来读取指定 bucket。</p>
<p>通过哈希函数计算键对象<code>name</code>的哈希值，对数组长度取余<code>hash(hashable)%k</code>，因为哈希值最右3位<code>110</code>为十进制<code>6</code>，则查看数组索引<code>6</code>对应的bucket是否为空，如果为空则将键值对放入，否则（<strong>哈希冲突</strong>）左移三位即<code>000</code>，查看索引<code>0</code>是否为空，循环直至找到空的bucket。</p>
<p>Python会根据哈希数组的拥挤程度对其扩容。“扩容”指的是:创造更大的数组，这时候会对已经存在的键值对重新进行哈希取余运算保存到其它位置；一般接近 2/3 时，数组就会扩容。扩容后，偏移量的数字个数增加，如数组长度扩容到16时，可以用最右边4位数字作为偏移量。</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/188640527">https://zhuanlan.zhihu.com/p/188640527</a></p>
<p>对于散列表而言，无论设置的存储区域（n）有多大，当需要存储的数据大于 n 时，那么必然会存在哈希值相同的情况。这就是所谓的<strong>散列冲突</strong>。</p>
<p>哈希冲突解决方法有两类：开放寻址法（open addressing）和链表法（chaining）</p>
<p>开放寻址法：</p>
<blockquote>
<p>将散列函数扩展定义成探查序列，即每个关键字有一个探查序列h(k,0)、h(k,1)、…、h(k,m-1)，这个探查序列一定是0….m-1的一个排列（一定要包含散列表全部的下标，不然可能会发生虽然散列表没满，但是元素不能插入的情况），如果给定一个关键字k，首先会看h(k,0)是否为空，如果为空，则插入；如果不为空，则看h(k,1)是否为空。</p>
</blockquote>
<p>开放寻址法是一种解决碰撞的方法，对于开放寻址冲突解决方法，比较经典的有线性探测方法（Linear Probing）、二次探测（Quadratic probing）和 双重散列（Double hashing）等方法</p>
<p>线性探测方法：</p>
<ul>
<li>当我们往散列表中插入数据时，如果某个数据经过散列函数散列之后，存储位置已经被占用了，我们就从当前位置开始，依次往后查找，看是否有空闲位置，直到找到为止</li>
<li>线性探测法一个很大的弊端就是当散列表中插入的数据越来越多时，散列冲突发生的可能性就会越来越大，空闲位置会越来越少，线性探测的时间就会越来越久。极端情况下，需要从头到尾探测整个散列表，所以最坏情况下的时间复杂度为 O(n)</li>
</ul>
<p>二次探测：</p>
<ul>
<li>二次探测是二次方探测法的简称。顾名思义，使用二次探测进行探测的步长变成了原来的“二次方”，也就是说，它探测的下标序列为 <code>hash(key)+0</code>，<code>hash(key)+1^2</code>或<code>[hash(key)-1^2]</code>，<code>hash(key)+2^2</code>或<code>[hash(key)-2^2]</code>。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic4.zhimg.com/50/v2-0adbdf4c6735aedf6c0e992831d38a65_hd.webp?source=1940ef5c" alt=""></p>
<ul>
<li><p>以上图为例，散列表的大小为 8 ，黄色区域表示空闲位置，橙色区域表示已经存储了数据。目前散列表中已经存储了 7 个元素。此时元素 7777777  经过 Hash 算法之后，被散列到位置下标为 7 的位置，但是这个位置已经有数据了，所以就产生了冲突。</p>
<p>按照<strong>二次探测方法</strong>的操作，有冲突就先 + 1^2，8 这个位置有值，冲突；变为 - 1^2，6 这个位置有值，还是有冲突；于是 - 2^2， 3 这个位置是空闲的，插入</p>
</li>
</ul>
<p>双重散列方法:</p>
<ul>
<li>所谓双重散列，意思就是不仅要使用一个散列函数，而是使用一组散列函数 <code>hash1(key)</code>，<code>hash2(key)</code>，<code>hash3(key)</code>。。。。。。先用第一个散列函数，如果计算得到的存储位置已经被占用，再用第二个散列函数，依次类推，直到找到空闲的存储位置。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic2.zhimg.com/50/v2-051443ba8bdca4e1d09bbeb8ea1e8e7d_hd.webp?source=1940ef5c" alt=""></p>
<ul>
<li><p>以上图为例，散列表的大小为 8 ，黄色区域表示空闲位置，橙色区域表示已经存储了数据。目前散列表中已经存储了 7 个元素。此时元素 7777777  经过 Hash 算法之后，被散列到位置下标为 7 的位置，但是这个位置已经有数据了，所以就产生了冲突。</p>
<p>此时，再将数据进行一次哈希算法处理，经过另外的 Hash 算法之后，被散列到位置下标为 3 的位置，完成操作</p>
</li>
</ul>
<p>事实上，不管采用哪种探测方法，只要当散列表中空闲位置不多的时候，散列冲突的概率就会大大提高。为了尽可能保证散列表的操作效率，一般情况下，需要尽可能保证散列表中有一定比例的空闲槽位。</p>
<p>一般使用<strong>加载因子</strong>（load factor）来表示空位的多少。</p>
<p><strong>加载因子</strong>是表示 Hsah 表中元素的填满的程度，若加载因子越大，则填满的元素越多,这样的好处是：空间利用率高了,但冲突的机会加大了。反之,加载因子越小,填满的元素越少,好处是冲突的机会减小了，但空间浪费多了。</p>
<p>链表法：</p>
<ul>
<li>链表法是一种更加常用的散列冲突解决办法，相比开放寻址法，它要简单很多。如下动图所示，在散列表中，每个位置对应一条链表，所有散列值相同的元素都放到相同位置对应的链表中。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic1.zhimg.com/50/v2-0defc2ef0b8ab581bb6e8d0569a882ee_hd.webp?source=1940ef5c" alt=""></p>
<p>LRU Cache</p>
<p>Least-Recently-Used 替换掉最近最少使用的对象</p>
<ul>
<li>缓存剔除策略，当缓存空间不够用的时候需要一种方式剔除key</li>
<li>常见的有 LRU，LFU 等</li>
<li>LRU通过使用一个循环双端队列不断把最新访问的key 放到表头实现</li>
</ul>
<p>实现LRUCache</p>
<ul>
<li>字典用来缓存，循环双端链表用来记录访问顺序 </li>
<li>利用 Python 内置的 dict + collections.OrderedDict 实现</li>
<li>dict 用来当做 k/v 键值对的缓存</li>
<li>OrderedDict 用来实现更新最近访问的 key</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, capacity=<span class="number">128</span></span>):</span><br><span class="line">        self.capacity = capacity</span><br><span class="line">        self.od = OrderedDict()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每次访问更新最新使用的key</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.od:</span><br><span class="line">            val = self.od[key]</span><br><span class="line">            self.od.move_to_end(key)  <span class="comment"># 把最近访问的放在尾部，就是最新的</span></span><br><span class="line">            <span class="keyword">return</span> val</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 更新 k / v</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, key, value</span>):</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.od:</span><br><span class="line">            <span class="keyword">del</span> self.od[key]</span><br><span class="line">            self.od[key] = value  <span class="comment"># 相当于更新key到表头，表示最新访问的</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.od[key] = value</span><br><span class="line">            <span class="comment"># 判断当前容量是否满了</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(self.od) &gt; self.capacity:</span><br><span class="line">                self.od.popitem(last=<span class="literal">False</span>)  <span class="comment"># 容量满了删除最早的key</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="python常考算法"><a href="#python常考算法" class="headerlink" title="python常考算法"></a>python常考算法</h2><p>排序 + 查找</p>
<ul>
<li>常考排序算法：冒泡排序、快速排序、归并排序、堆排序</li>
<li>线性查找，二分查找等</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210307143008.png" alt=""></p>
<p><strong>什么是排序算法的稳定性？</strong></p>
<ul>
<li>相同大小的元素在排序之后依然保持相对位置不变，就是稳定的</li>
<li>r[i]=r[j] 且 r[i]在r[j] 之前，排序之后 r[i] 依然在 r[j] 之前</li>
<li>稳定性对于排序一个复杂结构，并且需要保持原有排序才有意义</li>
</ul>
<h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><p>快排经常问：分治法(divide and conquer)，快排三步走：</p>
<ul>
<li>Partition: 选择基准分割数组为两个子数组，小于基准和大于基准的</li>
<li>对两个子数组分别快排，(递归处理)</li>
<li>合并结果</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">quick_sort</span>(<span class="params">array</span>):</span><br><span class="line">    <span class="comment"># 递归出口</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(array) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> array</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        pivot_index = <span class="number">0</span>  <span class="comment"># 选择第一个元素作为基准元素</span></span><br><span class="line">        pivot = array[pivot_index]</span><br><span class="line">        left_sort = [</span><br><span class="line">            i <span class="keyword">for</span> i <span class="keyword">in</span> array[pivot_index + <span class="number">1</span>:] <span class="keyword">if</span> i &lt;= pivot</span><br><span class="line">        ]</span><br><span class="line">        right_sort = [</span><br><span class="line">            i <span class="keyword">for</span> i <span class="keyword">in</span> array[pivot_index + <span class="number">1</span>:] <span class="keyword">if</span> i &gt; pivot</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">return</span> quick_sort(left_sort) + [pivot] + quick_sort(right_sort)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="keyword">import</span> random</span><br><span class="line">    lt = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line">    random.shuffle(lt)</span><br><span class="line">    <span class="built_in">print</span>(lt)</span><br><span class="line">    <span class="built_in">print</span>(quick_sort(lt))</span><br><span class="line"></span><br><span class="line">test()</span><br></pre></td></tr></table></figure>
<h3 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h3><p>实现合并两个有序数组</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge_sorted_list</span>(<span class="params">sorted_a, sorted_b</span>):</span><br><span class="line">    length_a, length_b = <span class="built_in">len</span>(sorted_a), <span class="built_in">len</span>(sorted_b)</span><br><span class="line">    <span class="comment"># 设置两个指针</span></span><br><span class="line">    a = b = <span class="number">0</span></span><br><span class="line">    new_sorted_seq = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> a &lt; length_a <span class="keyword">and</span> b &lt; length_b:</span><br><span class="line">        <span class="keyword">if</span> sorted_a[a] &lt; sorted_b[b]:</span><br><span class="line">            new_sorted_seq.append(sorted_a[a])</span><br><span class="line">            a += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            new_sorted_seq.append(sorted_b[b])</span><br><span class="line">            b += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> a &lt; length_a:</span><br><span class="line">        new_sorted_seq.extend(sorted_a[a:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        new_sorted_seq.extend(sorted_b[b:])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> new_sorted_seq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_merge_sorted_list</span>():</span><br><span class="line">    a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>]</span><br><span class="line">    b = [<span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>]</span><br><span class="line">    <span class="built_in">print</span>(merge_sorted_list(a, b))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test_merge_sorted_list()</span><br></pre></td></tr></table></figure>
<p>归并排序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge_sorted_list</span>(<span class="params">sorted_a, sorted_b</span>):</span><br><span class="line">    length_a, length_b = <span class="built_in">len</span>(sorted_a), <span class="built_in">len</span>(sorted_b)</span><br><span class="line">    <span class="comment"># 设置两个指针</span></span><br><span class="line">    a = b = <span class="number">0</span></span><br><span class="line">    new_sorted_seq = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> a &lt; length_a <span class="keyword">and</span> b &lt; length_b:</span><br><span class="line">        <span class="keyword">if</span> sorted_a[a] &lt; sorted_b[b]:</span><br><span class="line">            new_sorted_seq.append(sorted_a[a])</span><br><span class="line">            a += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            new_sorted_seq.append(sorted_b[b])</span><br><span class="line">            b += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> a &lt; length_a:</span><br><span class="line">        new_sorted_seq.extend(sorted_a[a:])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        new_sorted_seq.extend(sorted_b[b:])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> new_sorted_seq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_merge_sorted_list</span>():</span><br><span class="line">    a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>]</span><br><span class="line">    b = [<span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>]</span><br><span class="line">    <span class="built_in">print</span>(merge_sorted_list(a, b))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mergesort</span>(<span class="params">array</span>):</span><br><span class="line">    <span class="comment"># 递归出口</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(array) &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> array</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        mid = <span class="built_in">int</span>(<span class="built_in">len</span>(array) / <span class="number">2</span>)</span><br><span class="line">        left_half = mergesort(array[:mid])</span><br><span class="line">        right_half = mergesort(array[mid:])</span><br><span class="line">        <span class="keyword">return</span> merge_sorted_list(left_half, right_half)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_mergesort</span>():</span><br><span class="line">    <span class="keyword">import</span> random</span><br><span class="line">    lt = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line">    random.shuffle(lt)</span><br><span class="line">    <span class="built_in">print</span>(lt)</span><br><span class="line">    <span class="built_in">print</span>(mergesort(lt))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test_mergesort()</span><br></pre></td></tr></table></figure>
<h3 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> heapq <span class="keyword">import</span> heappush, heappop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">heapsort</span>(<span class="params">iterable</span>):</span><br><span class="line">    items = []</span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> iterable:</span><br><span class="line">        heappush(items, value)</span><br><span class="line">    <span class="keyword">return</span> [heappop(items) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(items))]</span><br></pre></td></tr></table></figure>
<h3 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">binary_search</span>(<span class="params">sorted_array, val</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> sorted_array:</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    beg, end = <span class="number">0</span>, <span class="built_in">len</span>(sorted_array) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> beg &lt;= end:</span><br><span class="line">        mid = <span class="built_in">int</span>((beg + end) / <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> sorted_array[mid] == val:</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">        <span class="keyword">elif</span> sorted_array[mid] &gt; val:  <span class="comment"># 要找的值小于中间的值，就往左边找</span></span><br><span class="line">            end = mid - <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            beg = mid + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="python常考数据结构"><a href="#python常考数据结构" class="headerlink" title="python常考数据结构"></a>python常考数据结构</h2><h3 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h3><p>单链表、双链表、循环双端链表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210307151551.png" alt=""></p>
<p>反转链表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</span></span><br><span class="line"><span class="string">Output:5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ListNode</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data, <span class="built_in">next</span>=<span class="literal">None</span></span>):</span><br><span class="line">        self.val = data</span><br><span class="line">        self.<span class="built_in">next</span> = <span class="built_in">next</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverseList</span>(<span class="params">head</span>):</span><br><span class="line">    pre = <span class="literal">None</span></span><br><span class="line">    cur = head</span><br><span class="line">    <span class="comment"># 把cur值前移，pre也前移，相当于把之前的cur值赋值给pre，一直到cur指向了None</span></span><br><span class="line">    <span class="keyword">while</span> cur:</span><br><span class="line">        nextnode = cur.<span class="built_in">next</span></span><br><span class="line">        cur.<span class="built_in">next</span> = pre  <span class="comment"># cur往回指</span></span><br><span class="line">        pre = cur</span><br><span class="line">        cur = nextnode</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pre</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    link = ListNode(<span class="number">1</span>, ListNode(<span class="number">2</span>, ListNode(<span class="number">3</span>, ListNode(<span class="number">4</span>, ListNode(<span class="number">5</span>)))))</span><br><span class="line">    root = reverseList(link)</span><br><span class="line">    <span class="keyword">while</span> root:</span><br><span class="line">        <span class="built_in">print</span>(root.val)</span><br><span class="line">        root = root.<span class="built_in">next</span></span><br><span class="line">        </span><br><span class="line"> <span class="comment"># 输出结果：</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>删除链表中的节点</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">请编写一个函数，使其可以删除某个链表中给定的（非末尾）节点，你将只被给定要求被删除的节点。</span></span><br><span class="line"><span class="string">示例 1:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">输入: head = [4,5,1,9], node = 5</span></span><br><span class="line"><span class="string">输出: [4,1,9]</span></span><br><span class="line"><span class="string">解释: 给定你链表中值为 5 的第二个节点，那么在调用了你的函数之后，该链表应变为 4 -&gt; 1 -&gt; 9.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><ul>
<li>实现队列的 apend 和 pop 操作，如何做到先进先出</li>
<li>使用 Python 的 list 或者 collections.deque 实现队列</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Queue</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.items = deque()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">append</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items.append(val)   <span class="comment"># 右边加</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items.popleft()    <span class="comment"># 左边取</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">empty</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.items) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_queue</span>():</span><br><span class="line">    q = Queue()</span><br><span class="line">    q.append(<span class="number">0</span>)</span><br><span class="line">    q.append(<span class="number">1</span>)</span><br><span class="line">    q.append(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(q.pop())</span><br><span class="line">    <span class="built_in">print</span>(q.pop())</span><br><span class="line">    <span class="built_in">print</span>(q.pop())</span><br><span class="line"></span><br><span class="line">test_queue()</span><br></pre></td></tr></table></figure>
<h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><p>实现栈的 push 和 pop 操作，后进先出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.deque = deque()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, val</span>):</span><br><span class="line">        self.deque.append(val)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>):</span><br><span class="line">        self.deque.pop()</span><br></pre></td></tr></table></figure>
<p>如何用两个栈实现一个队列：</p>
<ul>
<li>将stack1作为存储空间，将stack2作为临时缓冲区；也就是stack2辅助stack1做出队与入队操作</li>
<li>入队时，直接将元素压入stack1即可</li>
<li>出队时，先判断stack2中是否有数据<ul>
<li>如果有数据的话，直接pop() stack2中的数据（因为pop是直接弹出最后一个数据）</li>
<li>如果stack2中没有数据，则将stack1中的数据，push到stack2中，然后stack2中就有了先到的数据，实现了队列的的先进先出</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">用两个栈实现一个队列</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.items = deque()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items.append(val)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items.pop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">top</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items[-<span class="number">1</span>]  <span class="comment"># 返回栈顶值</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">empty</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.items) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.s1 = Stack()</span><br><span class="line">        self.s2 = Stack()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, x</span>):</span><br><span class="line">        self.s1.push(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.s2.empty():</span><br><span class="line">            <span class="keyword">return</span> self.s2.pop()</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.s1.empty():</span><br><span class="line">            val = self.s1.pop()</span><br><span class="line">            self.s2.push(val)</span><br><span class="line">        <span class="keyword">return</span> self.s2.pop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">peek</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.s2.empty():</span><br><span class="line">            <span class="keyword">return</span> self.s2.top()</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.s1.empty():</span><br><span class="line">            val = self.s1.pop()</span><br><span class="line">            self.s2.push(val)</span><br><span class="line">        <span class="keyword">return</span> self.s2.top()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">empty</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.s1.empty() <span class="keyword">and</span> self.s2.empty()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    q = MyQueue()</span><br><span class="line">    q.push(<span class="number">1</span>)</span><br><span class="line">    q.push(<span class="number">2</span>)</span><br><span class="line">    q.push(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(q.pop())</span><br><span class="line">    <span class="built_in">print</span>(q.pop())</span><br><span class="line">    <span class="built_in">print</span>(q.pop())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="字典和集合"><a href="#字典和集合" class="headerlink" title="字典和集合"></a>字典和集合</h3><p>Python dict/set 底层都是哈希表</p>
<ul>
<li>哈希表的实现原理，底层其实就是一个数组</li>
<li>根据哈希函数快速定位一个元素，平均查找 O(1)，非常快</li>
<li>不断加入元素会引起哈希表重新开辟空间，拷贝之前元素到新数组</li>
</ul>
<p>哈希冲突</p>
<h3 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h3><p>先序、中序、后序遍历</p>
<ul>
<li>先(根)序：先处理根，之后是左子树，然后是右子树</li>
<li>中(根)序：先处理左子树，然后是跟，然后是右子树</li>
<li>后(根)序：先处理左子树，然后是右子树，最后是根</li>
</ul>
<p>树的遍历：</p>
<p>先序遍历，其实很简单，递归代码里先处理根就好了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BinTreeNode</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data, left=<span class="literal">None</span>, right=<span class="literal">None</span></span>):</span><br><span class="line">        self.data = data</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinTree</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, root=<span class="literal">None</span></span>):</span><br><span class="line">        self.root = root</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preorder_trav</span>(<span class="params">self, subtree</span>):</span><br><span class="line">        <span class="string">&quot;先序遍历&quot;</span></span><br><span class="line">        <span class="keyword">if</span> subtree <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span>(subtree.data)   <span class="comment"># 先处理根</span></span><br><span class="line">            self.preorder_trav(subtree.left)     <span class="comment"># 递归处理左子树</span></span><br><span class="line">            self.preorder_trav(subtree.right)    <span class="comment"># 递归处理右子树</span></span><br></pre></td></tr></table></figure>
<h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><p>堆其实是完全二叉树，有最大堆和最小堆</p>
<ul>
<li>最大堆：对于每个非叶子节点V，V 的值都比它的两个孩子大</li>
<li>最大堆支持每次 pop 操作获取最大的元素，最小堆获取最小元素</li>
<li>常见问题：用堆来完成 topk 问题，从海量数字中寻找最大的 k 个</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TopK</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    获取大量元素 topK 大个元素，固定内存</span></span><br><span class="line"><span class="string">    思路：</span></span><br><span class="line"><span class="string">    1、先放入元素前k个建立一个最小堆</span></span><br><span class="line"><span class="string">    2、迭代剩余元素：</span></span><br><span class="line"><span class="string">        如果当前元素小于堆顶元素，跳过该元素</span></span><br><span class="line"><span class="string">        否则替换堆顶元素为当前元素，并重新调整堆</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, iterable, k</span>):</span><br><span class="line">        self.minheap = []</span><br><span class="line">        self.iterable = iterable</span><br><span class="line">        self.capacity = k</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.minheap) &gt;= self.capacity:</span><br><span class="line">            min_val = self.minheap[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> val &lt; min_val:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                heapq.heapreplace(self.minheap, val)  <span class="comment"># 返回并且pop 堆顶最小值，推入新的val值并调整堆</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            heapq.heappush(self.minheap, val)  <span class="comment"># 前k个元素直接放入minheap</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_topk</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> val <span class="keyword">in</span> self.iterable:</span><br><span class="line">            self.push(val)</span><br><span class="line">        <span class="keyword">return</span> self.minheap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="keyword">import</span> random</span><br><span class="line">    lt = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1000</span>))</span><br><span class="line">    random.shuffle(lt)</span><br><span class="line">    aa = TopK(lt, <span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(aa.get_topk())  <span class="comment"># [995, 996, 999, 997, 998]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>反转字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reverseStr</span>(<span class="params">s</span>):</span><br><span class="line">    beg, end = <span class="number">0</span>, <span class="built_in">len</span>(s) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> beg &lt; end:</span><br><span class="line">        s[beg], s[end] = s[end], s[beg]</span><br><span class="line">        beg += <span class="number">1</span></span><br><span class="line">        end -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(reverseStr([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>]))</span><br></pre></td></tr></table></figure>
<p>判断回文数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">isPalindrome</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    s = <span class="built_in">str</span>(x)</span><br><span class="line">    beg, end = <span class="number">0</span>, <span class="built_in">len</span>(s) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> beg &lt; end:</span><br><span class="line">        <span class="keyword">if</span> s[beg] == s[end]:</span><br><span class="line">            beg += <span class="number">1</span></span><br><span class="line">            end -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(isPalindrome(<span class="number">1234321</span>))</span><br></pre></td></tr></table></figure>
<h2 id="python面向对象"><a href="#python面向对象" class="headerlink" title="python面向对象"></a>python面向对象</h2><h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编写一个记录函数耗时的装饰器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">log_time</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        start = time.time()</span><br><span class="line">        res = func(*args, **kwargs)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;use time: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(time.time() - start))</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@log_time</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mysleep</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysleep()</span><br></pre></td></tr></table></figure>
<p>使用类来编写装饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogTime</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, func</span>):</span><br><span class="line"><span class="meta">        @wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">_log</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            start_time = time.time()</span><br><span class="line">            res = func(*args, **kwargs)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;use time: <span class="subst">&#123;time.time() - start_time&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@LogTime()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mysleep2</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysleep2()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>给装饰器加参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogTimeParams</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, use_int=<span class="literal">False</span></span>):</span><br><span class="line">        self.use_int = use_int</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, func</span>):</span><br><span class="line"><span class="meta">        @wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">_log</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            start_time = time.time()</span><br><span class="line">            res = func(*args, **kwargs)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;use time: <span class="subst">&#123;time.time() - start_time&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@LogTimeParams()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mysleep2</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysleep2()</span><br></pre></td></tr></table></figure>
<h3 id="常见的设计模式"><a href="#常见的设计模式" class="headerlink" title="常见的设计模式"></a>常见的设计模式</h3><h4 id="常见创建型设计模式："><a href="#常见创建型设计模式：" class="headerlink" title="常见创建型设计模式："></a>常见创建型设计模式：</h4><ul>
<li>工厂模式(Factory): 解决对象创建问题</li>
<li>构造模式(Builder): 控制复杂对象的创建</li>
<li>原型模式(Prototype)：通过原型的克隆创建新的实例</li>
<li>单例(Borg/Singleton): 一个类只能创建同一个对象</li>
<li>对象池模式(Pool): 预先分配同一类型的一组实例 </li>
<li>惰性计算模式(Lazy Evaluation)：延迟计算(python 的property)</li>
</ul>
<p>工厂模式</p>
<ul>
<li>解决对象创建问题</li>
<li>解耦对象的创建和使用</li>
<li>包括工厂方法和抽象工厂</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个工厂方法的例子</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DogToy</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;wang wang&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CatToy</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;miao miao&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">toy_factory</span>(<span class="params">toy_type</span>):</span><br><span class="line">    <span class="keyword">if</span> toy_type == <span class="string">&#x27;dog&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> DogToy()</span><br><span class="line">    <span class="keyword">elif</span> toy_type == <span class="string">&#x27;cat&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> CatToy()</span><br></pre></td></tr></table></figure>
<p>构造模式：</p>
<ul>
<li>用来控制复杂对象的构造</li>
<li>创建和表示分离。比如你要买电脑，工厂模式直接给你需要的电脑</li>
<li>但是构造模式允许你自己定义电脑的配置，组装完成后给你</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个构造模式的例子</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, serial_number</span>):</span><br><span class="line">        self.serial = serial_number</span><br><span class="line">        self.memory = <span class="literal">None</span>  <span class="comment"># in gigabytes</span></span><br><span class="line">        self.hdd = <span class="literal">None</span>  <span class="comment"># in gigabytes</span></span><br><span class="line">        self.gpu = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        info = (<span class="string">&#x27;Memory: &#123;&#125;GB&#x27;</span>.<span class="built_in">format</span>(self.memory),</span><br><span class="line">                <span class="string">&#x27;Hard Disk: &#123;&#125;GB&#x27;</span>.<span class="built_in">format</span>(self.hdd),</span><br><span class="line">                <span class="string">&#x27;Graphics Card: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(self.gpu))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;\n&#x27;</span>.join(info)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputerBuilder</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.computer = Computer(<span class="string">&#x27;AG23385193&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_memory</span>(<span class="params">self, amount</span>):</span><br><span class="line">        self.computer.memory = amount</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_hdd</span>(<span class="params">self, amount</span>):</span><br><span class="line">        self.computer.hdd = amount</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_gpu</span>(<span class="params">self, gpu_model</span>):</span><br><span class="line">        self.computer.gpu = gpu_model</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HardwareEngineer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.builder = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">construct_computer</span>(<span class="params">self, memory, hdd, gpu</span>):</span><br><span class="line">        self.builder = ComputerBuilder()</span><br><span class="line">        var = [step <span class="keyword">for</span> step <span class="keyword">in</span> (self.builder.configure_memory(memory),</span><br><span class="line">                                 self.builder.configure_hdd(hdd),</span><br><span class="line">                                 self.builder.configure_gpu(gpu))]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">computer</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.builder.computer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用buidler，可以创建多个builder类实现不同的组装方式</span></span><br><span class="line">engineer = HardwareEngineer()</span><br><span class="line">engineer.construct_computer(hdd=<span class="number">1000</span>, memory=<span class="number">32</span>, gpu=<span class="string">&#x27;GeForce RTX 3070&#x27;</span>)</span><br><span class="line">computer = engineer.computer</span><br><span class="line"><span class="built_in">print</span>(computer)</span><br></pre></td></tr></table></figure>
<p>原型模式：</p>
<ul>
<li>通过克隆原型来创建新的实例</li>
<li>可以使用相同的原型，通过修改部分属性来创建新的示例</li>
<li>用途：对于一些创建实例开销比较高的地方可以用原型模式</li>
</ul>
<p>单例模式：</p>
<ul>
<li>单例模式：一个类创建出来的对象都是同一个</li>
<li>Python的模块其实就是单例的，只会导入一次</li>
<li>使用共享同一个实例的方式来创建单例模式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单例模式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(cls, <span class="string">&#x27;_instance&#x27;</span>):</span><br><span class="line">            _instance = <span class="built_in">super</span>().__new__(cls, *args, **kwargs)</span><br><span class="line">            cls._instance = _instance</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>(<span class="title class_ inherited__">Singleton</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c1 = MyClass()</span><br><span class="line">c2 = MyClass()</span><br><span class="line"><span class="keyword">assert</span> c1 <span class="keyword">is</span> c2  <span class="comment"># 单例的，c1 c2 同一个实例</span></span><br></pre></td></tr></table></figure>
<h4 id="常见结构型设计模式"><a href="#常见结构型设计模式" class="headerlink" title="常见结构型设计模式"></a>常见结构型设计模式</h4><ul>
<li>装饰器模式(Decorator): 无需子类化扩展对象功能</li>
<li>代理模式(Proxy): 把一个对象的操作代理到另一个对象</li>
<li>适配器模式(Adapter)：通过一个间接层适配统一接口</li>
<li>外观模式(Facade): 简化复杂对象的访问问题</li>
<li>享元模式(Flyweight): 通过对象复用(池)改善资源利用，比如连接池</li>
<li>Model-View-Controller(MVC)：解耦展示逻辑和业务逻辑</li>
</ul>
<p>代理模式：</p>
<ul>
<li>把一个对象的操作代理到另个一对象</li>
<li>这里又要提到我们之前实现的Stack/Queue，把操作代理到 deque</li>
<li>通常使用 has-a 组合关系</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span>(<span class="title class_ inherited__">object</span>):  <span class="comment"># 使用组合的例子</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._deque = deque()   <span class="comment"># has a deque()</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">return</span> self._deque.append(value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._deque.pop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">empty</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self._deque) == <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>适配器模式(Adapter)：</p>
<ul>
<li>把不同对象的接口适配到同一个接口</li>
<li>想象一个多功能充电头，可以给不同的电器充电，充当了适配</li>
<li>当我们需要给不同的对象统一接口的时候可以使用适配器模式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 适配器模式的例子</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.name = <span class="string">&quot;Dog&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bark</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;woof!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.name = <span class="string">&quot;Cat&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">meow</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;meow!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adapter</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, obj, **adapted_methods</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;We set the adapted methods in the object&#x27;s dict&quot;&quot;&quot;</span></span><br><span class="line">        self.obj = obj</span><br><span class="line">        self.__dict__.update(adapted_methods)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getattr__</span>(<span class="params">self, attr</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;All non-adapted calls are passed to the object&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">getattr</span>(self.obj, attr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">objects = []</span><br><span class="line">dog = Dog()</span><br><span class="line">objects.append(Adapter(dog, make_noise=dog.bark))</span><br><span class="line">cat = Cat()</span><br><span class="line">objects.append(Adapter(cat, make_noise=cat.meow))</span><br><span class="line"><span class="keyword">for</span> obj <span class="keyword">in</span> objects:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;A &#123;0&#125; goes &#123;1&#125;&quot;</span>.<span class="built_in">format</span>(obj.name, obj.make_noise()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果：</span></span><br><span class="line">A Dog goes woof!</span><br><span class="line">A Cat goes meow!</span><br></pre></td></tr></table></figure>
<h4 id="常见行为型设计模式"><a href="#常见行为型设计模式" class="headerlink" title="常见行为型设计模式"></a>常见行为型设计模式</h4><ul>
<li>迭代器模式(Iterator): 通过统一的接口迭代对象 </li>
<li>观察者模式(Observer):对象发生改变的时候，观察者执行相应动作</li>
<li>策略模式(Strategy): 针对不同规模输入使用不同的策略</li>
</ul>
<p>迭代器模式：</p>
<ul>
<li>Python内置对迭代器模式的支持</li>
<li>比如我们可以用 for 遍历各种 Iterable 的数据类型</li>
<li>Python里可以实现<code>__next__</code>和 <code>__iter__</code> 实现迭代器 </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span>(<span class="title class_ inherited__">object</span>):  <span class="comment"># 使用组合的例子</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._deque = deque()   <span class="comment"># has a deque()</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">return</span> self._deque.append(value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._deque.pop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">empty</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self._deque) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self._deque:</span><br><span class="line">            res.append(i)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(res):</span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line">s = Stack()</span><br><span class="line">s.push(<span class="number">1</span>)</span><br><span class="line">s.push(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>
<p>观察者模式：</p>
<ul>
<li>发布订阅是一种最常用的实现方式</li>
<li>发布订阅用于解耦逻辑</li>
<li>可以通过回调等方式实现，当发生事件时，调用相应的回调函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发布订阅模式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Publisher</span>:  <span class="comment"># 发布者</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.observers = []  <span class="comment"># 观察者</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, observer</span>):  <span class="comment"># 加入观察者</span></span><br><span class="line">        <span class="keyword">if</span> observer <span class="keyword">not</span> <span class="keyword">in</span> self.observers:</span><br><span class="line">            self.observers.append(observer)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Failed to add : &#123;&#125;&#x27;</span>).<span class="built_in">format</span>(observer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">self, observer</span>):  <span class="comment"># 移除观察者</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.observers.remove(observer)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Failed to remove : &#123;&#125;&#x27;</span>).<span class="built_in">format</span>(observer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self</span>):  <span class="comment"># 调用观察者的回调</span></span><br><span class="line">        [o.notify_by(self) <span class="keyword">for</span> o <span class="keyword">in</span> self.observers]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Formatter</span>(<span class="title class_ inherited__">Publisher</span>):  <span class="comment"># 继承自发布者</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.name = name</span><br><span class="line">        self._data = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._data</span><br><span class="line"></span><br><span class="line"><span class="meta">    @data.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">data</span>(<span class="params">self, new_value</span>):</span><br><span class="line">        self._data = <span class="built_in">int</span>(new_value)</span><br><span class="line">        self.notify()  <span class="comment"># data 在被合法赋值以后会执行notify</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinaryFormatter</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 订阅者 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify_by</span>(<span class="params">self, publisher</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;: &#x27;&#123;&#125;&#x27; has now bin data = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            <span class="built_in">type</span>(self).__name__,</span><br><span class="line">            publisher.name,</span><br><span class="line">            <span class="built_in">bin</span>(publisher.data))</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    df = Formatter(<span class="string">&#x27;formatter&#x27;</span>)  <span class="comment"># 发布者</span></span><br><span class="line">    bf = BinaryFormatter()  <span class="comment"># 订阅者</span></span><br><span class="line">    df.add(bf)  <span class="comment"># 添加订阅者</span></span><br><span class="line">    df.data = <span class="number">3</span>  <span class="comment"># 设置的时候调用订阅者的notify_by</span></span><br></pre></td></tr></table></figure>
<p>策略模式：</p>
<ul>
<li>根据不同的输入采用不同的策略</li>
<li>比如买东西超过10个打八折，超过20个打七折</li>
<li>对外暴露统一的接口，内部采用不同的策略计算</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 策略模式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, price, discount_strategy=<span class="literal">None</span></span>):</span><br><span class="line">        self.price = price</span><br><span class="line">        self.discount_strategy = discount_strategy</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">price_after_discount</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.discount_strategy:</span><br><span class="line">            discount = self.discount_strategy(self)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            discount = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> self.price - discount</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        fmt = <span class="string">&quot;&lt;Price: &#123;&#125;, price after discount: &#123;&#125;&gt;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> fmt.<span class="built_in">format</span>(</span><br><span class="line">            self.price, self.price_after_discount()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ten_percent_discount</span>(<span class="params">order</span>):</span><br><span class="line">    <span class="keyword">return</span> order.price * <span class="number">0.10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_sale_discount</span>(<span class="params">order</span>):</span><br><span class="line">    <span class="keyword">return</span> order.price * <span class="number">0.25</span> + <span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    order0 = Order(<span class="number">100</span>)</span><br><span class="line">    order1 = Order(<span class="number">100</span>, discount_strategy=ten_percent_discount)</span><br><span class="line">    order2 = Order(<span class="number">1000</span>, discount_strategy=on_sale_discount)</span><br><span class="line">    <span class="built_in">print</span>(order0)</span><br><span class="line">    <span class="built_in">print</span>(order1)</span><br><span class="line">    <span class="built_in">print</span>(order2)</span><br></pre></td></tr></table></figure>
<h2 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h2><p>Python支持部分函数式编程特性</p>
<ul>
<li>高阶函数: map/reduce/filter</li>
</ul>
<p>闭包：</p>
<ul>
<li>绑定了外部作用域的变量的函数 </li>
<li>即使程序离开外部作用域，如果闭包仍然可见，绑定变量不会销毁</li>
<li>每次运行外部函数都会重新创建闭包 </li>
</ul>
<h2 id="操作系统相关"><a href="#操作系统相关" class="headerlink" title="操作系统相关"></a>操作系统相关</h2><h3 id="Linux常见命令"><a href="#Linux常见命令" class="headerlink" title="Linux常见命令"></a>Linux常见命令</h3><p>如何查询 linux 命令的用法：</p>
<ul>
<li>使用 man 命令查询用法。但是 man 手册比较晦涩 </li>
<li>使用工具自带的help，比如 pip —help</li>
<li>这里介绍一个man 的替代工具 tldr。pip install tldr </li>
</ul>
<p>掌握常见的文件操作工具</p>
<ul>
<li>chown/chmod/chgrp        改变所有者/改变模式/改变所有组</li>
<li>ls/rm/cd/cp/mv/touch/rename/ln(软链接和硬链接) 等</li>
<li>locate/find/grep 定位查找和搜索</li>
</ul>
<p>文件或者日志查看工具：</p>
<ul>
<li>编辑器 vi/nano/vim</li>
<li>cat/head/tail 查看文件</li>
<li>more/less 交互式查看文件</li>
</ul>
<p>常见的进程操作工具:</p>
<ul>
<li>ps 查看进程</li>
<li>kill 杀死进程</li>
<li>top/htop 监控进程</li>
</ul>
<p>常见的网络工具:</p>
<ul>
<li>ifconfig 查看网卡信息 </li>
<li>lsof/netstat 查看端口信息</li>
<li>ssh/scp 远程登录/复制。tcpdump 抓包 </li>
</ul>
<h3 id="操作系统线程和进程"><a href="#操作系统线程和进程" class="headerlink" title="操作系统线程和进程"></a>操作系统线程和进程</h3><p>进程和线程：</p>
<ul>
<li>进程是对运行时程序的封装，是系统资源调度和分配的基本单位 </li>
<li>线程是进程的子任务, cpu 调度和分配的基本单位，实现进程内并发</li>
<li>一个进程可以包含多个线程，线程依赖进程存在，并共享进程内存</li>
</ul>
<p>线程安全：</p>
<ul>
<li>一个操作可以在多线程环境中安全使用，获取正确的结果 </li>
<li>线程安全的操作好比线程是顺序执行而不是并发执行的(i += 1)</li>
<li>一般如果涉及到写操作需要考虑如何让多个线程安全访问数据 </li>
</ul>
<p>了解线程同步的方式，如何保证线程安全：</p>
<ul>
<li>互斥量（锁）: 通过互斥机制防止多个线程同时访问公共资源 </li>
<li>信号量(Semphare):控制同一时刻多个线程访问同一个资源的线程数</li>
<li>事件(信号): 通过通知的方式保持多个线程同步</li>
</ul>
<p>进程间通信的方式：</p>
<ul>
<li>管道/匿名管道/有名管道(pipe) </li>
<li>信号(Signal): 比如用户使用Ctrl+c 产生 SIGINT 程序终止信号</li>
<li>消息队列 (Message)</li>
<li>共享内存(share memory) </li>
<li>信号量(Semaphore)</li>
<li>套接字 (socket)：最常用的方式，我们的 web 应用都是这种方式</li>
</ul>
<p>python中如何使用多线程：</p>
<ul>
<li>threading.Thread 类用来创建线程</li>
<li>start() 方法启动线程</li>
<li>可以用 join() 等待线程结束 </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">lock = threading.Lock()</span><br><span class="line"></span><br><span class="line">n = [<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    <span class="keyword">with</span> lock:</span><br><span class="line">        n[<span class="number">0</span>] = n[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line">        n[<span class="number">0</span>] = n[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5000</span>):</span><br><span class="line">    t = threading.Thread(target=foo)</span><br><span class="line">    threads.append(t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python中使用多进程：</p>
<p>multiprocessing模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多进程</span></span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;worker function&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> fib(n - <span class="number">1</span>) + fib(n - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    jobs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>, <span class="number">20</span>):</span><br><span class="line">        p = multiprocessing.Process(target=fib, args=(i,))</span><br><span class="line">        jobs.append(p)</span><br><span class="line">        p.start()</span><br></pre></td></tr></table></figure>
<h3 id="操作系统内存管理机制"><a href="#操作系统内存管理机制" class="headerlink" title="操作系统内存管理机制"></a>操作系统内存管理机制</h3><p>分页机制：</p>
<ul>
<li>逻辑地址和物理地址分离的内存管理方案</li>
<li>程序的逻辑地址划分为固定大小的页(Page) </li>
<li>物理地址划分为同样大小的帧(Frame)</li>
<li>通过页表对应逻辑地址和物理地址 </li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308092045.png" alt=""></p>
<p>分段机制：</p>
<ul>
<li>分段是为了满足代码的一些逻辑需求</li>
<li>数据共享，数据保护，动态链接等 </li>
<li>通过段表实现逻辑地址和物理地址的映射关系</li>
<li>每个段内部是连续内存分配，段和段之间是离散分配的</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308092154.png" alt=""></p>
<p>分页和分段的区别：</p>
<ul>
<li>页是出于内存利用率的角度提出的离散分配机制 </li>
<li>段是出于用户角度，用于数据保护、数据隔离等用途的管理机制</li>
<li>页的大小是固定的，操作系统决定；段大小不确定，用户程序决定</li>
</ul>
<p>什么是虚拟内存：</p>
<ul>
<li>把一部分暂时不用的内存信息放到硬盘上</li>
<li>局部性原理，程序运行时候只有部分必要的信息装入内存 </li>
<li>内存中暂时不需要的内容放到硬盘上</li>
<li>系统似乎提供了比实际内存大得多的容量，称之为虚拟内存</li>
</ul>
<p>什么是内存抖动：</p>
<ul>
<li><strong>本质是频繁的页调度行为</strong></li>
<li>频繁的页调度，进程不断产生缺页中断 </li>
<li>置换一个页，又不断再次需要这个页</li>
<li>运行程序太多；页面替换策略不好。终止进程或者增加物理内存</li>
</ul>
<h4 id="python的垃圾回收机制"><a href="#python的垃圾回收机制" class="headerlink" title="python的垃圾回收机制"></a>python的垃圾回收机制</h4><ul>
<li><p>引用计数为主（缺点：循环引用无法解决） </p>
<ul>
<li>引用计数增加：当对象创建 a = 1；对象被应用 b = a；对象作为参数传递func(a)；对象存储在容器中 l = [a]</li>
<li>引用计数减少：使用del a；引用指向了别的对象 b = None；离开对象的作用域(如函数执行结束)；从一个容器移除对象或者销毁容器</li>
</ul>
</li>
<li><p>引入标记清除和分代回收解决引用计数的问题</p>
<ul>
<li>如 a=[1]，b=[2]，a.append(b)，b.append(a)，a和b的引用计数都是2，这时候无法将a和b的引用计数变为0，两个对象相互引用之后引用计数无法归零，出现了循环引用的问题。</li>
<li>标记清除的算法，就是从根对象找到所有可达的点（上述例子中，就a和b相互引用，其他没有引用a和b的，是孤立的点，属于不可达的点），将所有不可达的点和可达的点标记，认为不可达的点没有其他地方引用了，就可以把它清除掉。</li>
</ul>
</li>
<li><p>引用计数为主+标记清除和分代回收为辅</p>
<ul>
<li>分代回收，python把对象的生命周期分为3代（0，1，2），每一代都使用双向链表来标记对象。一开始 创建的对象称为第0代，python会针对第0、1、2代每隔一段时间会执行标记回收，这是有阈值的，会每隔多收时间清除第0代、清除第1代、清除第2代。</li>
<li>比如说第0代执行完标记回收后，剩下的对象没有被回收，这个对象会转到更老的一代（第1代）。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">6</span>]: <span class="keyword">import</span> gc</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: gc.get_threshold()</span><br><span class="line">Out[<span class="number">7</span>]: (<span class="number">700</span>, <span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: gc.get_threshold?</span><br><span class="line">Signature: gc.get_threshold()</span><br><span class="line">Docstring: Return the current collection thresholds.</span><br><span class="line"><span class="type">Type</span>:      builtin_function_or_method</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h2><h3 id="网络协议TCP和UDP"><a href="#网络协议TCP和UDP" class="headerlink" title="网络协议TCP和UDP"></a>网络协议TCP和UDP</h3><p>浏览器输入一个url中间经历的过程</p>
<p>DNS缓存-&gt;DNS查询-&gt;拿到IP地址，浏览器就调用socket函数发起TCP请求（三次握手）-&gt;发起应用层协议，HTTP请求-&gt;Nginx反向代理-&gt;uwsgi/gunicorn-&gt;web app响应-&gt;TCP的四次挥手</p>
<p>TCP三次握手</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308095656.png" alt=""></p>
<p>TCP四次挥手：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308095719.png" alt=""></p>
<p>TCP和UDP：</p>
<ul>
<li>TCP面向连接、可靠的、基于字节流 </li>
<li>UDP 无连接、不可靠、面向报文</li>
</ul>
<h3 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h3><p>常见状态码：</p>
<ul>
<li>1** 信息。服务器收到请求，需要请求者继续执行操作 </li>
<li>2** 成功。操作被成功接受并处理</li>
<li>3** 重定向。需要进一步操作完成请求</li>
<li>4** 客户端错误。请求有语法错误或者无法完成请求 </li>
<li>5** 服务器错误。服务器在处理请求的过程中发生错误</li>
</ul>
<p>HTTP GET/POST 区别：</p>
<ul>
<li>Restful 语义上一个是获取，一个是创建 </li>
<li>GET 是幂等的，POST 非幂等</li>
<li>GET请求参数放到url(明文),长度限制；POST 放在请求体，更安全</li>
</ul>
<p>幂等性：</p>
<ul>
<li>幂等方法是无论调用多少次都得到相同结果的 HTTP 方法</li>
<li>例如： a=4 是幂等的，但是 a += 4 就是非幂等的</li>
<li>幂等的方法客户端可以安全地重发请求 </li>
</ul>
<p>幂等方法：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308101124.png" alt=""></p>
<p>什么是 HTTP 长连接：</p>
<ul>
<li>连接：建立连接…数据传输…关闭连接(连接的建立和关闭开销大) </li>
<li>长连接：Connection: Keep-alive。保持 TCP 连接不断开 </li>
<li>如何区分不同的 HTTP 请求呢？Content-Length | Transfer-Encoding: chunked</li>
</ul>
<p>cookie和 session 区别：</p>
<ul>
<li>Session 一般是服务器生成之后给客户端（通过 url 参数或cookie) </li>
<li>Cookie 是实现 session 的一种机制，通过 HTTP cookie 字段实现</li>
<li>Session通过在服务器保存 sessionid 识别用户，cookie 存储在客户端</li>
</ul>
<h3 id="TCP-socket编程"><a href="#TCP-socket编程" class="headerlink" title="TCP socket编程"></a>TCP socket编程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308101908.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">s = socket.socket()</span><br><span class="line">s.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8888</span>))</span><br><span class="line">s.listen()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    client, addr = s.accept()   <span class="comment"># return conn, addr</span></span><br><span class="line">    <span class="built_in">print</span>(client)</span><br><span class="line">    timestr = time.ctime(time.time()) + <span class="string">&#x27;\r\n&#x27;</span></span><br><span class="line">    client.send(timestr.encode())   <span class="comment"># send 参数 encode(&#x27;utf8&#x27;)</span></span><br><span class="line">    client.close()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8888</span>))</span><br><span class="line">s.sendall(<span class="string">b&#x27;Hello World&#x27;</span>)</span><br><span class="line">data = s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>
<p>如何使用 socket 发送HTTP请求:</p>
<ul>
<li>使用 socket 接口发送 HTTP 请求 </li>
<li>HTTP建立在TCP基础之上</li>
<li>HTTP是基于文本的协议 </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket()</span><br><span class="line">s.connect((<span class="string">&#x27;www.baidu.com&#x27;</span>, <span class="number">80</span>))</span><br><span class="line"></span><br><span class="line">http = <span class="string">b&quot;GET / HTTP/1.1\r\nHost: www.baidu.com\r\n\r\n&quot;</span></span><br><span class="line">s.sendall(http)</span><br><span class="line">buf = s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(buf)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>
<h3 id="IO多路复用"><a href="#IO多路复用" class="headerlink" title="IO多路复用"></a>IO多路复用</h3><p>一些常见的提升并发能力的方式：</p>
<ul>
<li>多线程模型，创建新的线程处理请求 </li>
<li>多进程模型，创建新的进程处理请求</li>
<li>IO多路复用，实现单进程同时处理多个 socket 请求 </li>
</ul>
<p>什么是 IO 多路复用：</p>
<ul>
<li><strong>操作系统提供的同时监听多个</strong> <strong>socket</strong> <strong>的机制</strong></li>
<li>为了实现高并发需要一种机制并发处理多个 socket </li>
<li>Linux 常见的是 select/poll/epoll</li>
<li>可以使用单线程单进程处理多个 socket </li>
</ul>
<p>阻塞IO服务端调用recvfrom的时候，经历了两个过程：</p>
<ul>
<li>内核等待数据</li>
<li>数据从内核拷贝到用户进程</li>
</ul>
<p>IO多路复用模型：</p>
<ul>
<li>当执行select调用的时候，第一步还是内核等待数据，但是只会阻塞在这一步，一旦返回socket可读，就直接调用recvfrom拿到数据。</li>
<li>select可以同时处理多个socket，有一个就绪应用程序代码就可以处理它</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    events = sel.select()</span><br><span class="line">    <span class="keyword">for</span> key, mask <span class="keyword">in</span> events:</span><br><span class="line">        callback = key.data</span><br><span class="line">        callback(key.fileobj, mask)</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308103329.png" alt=""></p>
<p>python如何实现IO多路复用：</p>
<ul>
<li>Python 的IO多路复用基于操作系统实现(select/poll/epoll) </li>
<li>Python2 select 模块 </li>
<li>Python3 selectors 模块 </li>
</ul>
<p>selectors 模块 ：</p>
<ul>
<li>事件类型：EVEN T_READ，EVENT_WRITE</li>
<li>DefaultSelector类：自动根据平台选取合适的IO模型<ul>
<li>register(fileobj, events, data=None)</li>
<li>unregister(fileobj)</li>
<li>modify(fileobj, envents, data=None)</li>
<li>select(timeout=None): returns[(key, events)]</li>
<li>close()</li>
</ul>
</li>
</ul>
<h3 id="Python并发网络库："><a href="#Python并发网络库：" class="headerlink" title="Python并发网络库："></a>Python并发网络库：</h3><ul>
<li>Tornado 并发网络库和同时也是一个web微框架 </li>
<li>Gevent 绿色线程(greenlet) 实现并发，猴子补丁修改内置 socket</li>
<li>Asyncio Python3 内置的并发网络库，基于原生协程 </li>
</ul>
<p>Tornado 适用于微服务，实现 Restful 接口：</p>
<ul>
<li>底层基于Linux 多路复用</li>
<li>可以通过协程或者回调实现异步编程</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">from</span> tornado.httpclient <span class="keyword">import</span> AsyncHTTPClient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIHandler</span>(tornado.web.RequestHandler):</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self</span>):</span><br><span class="line">        url = <span class="string">&#x27;http://httpbin.org/get&#x27;</span></span><br><span class="line">        http_client = AsyncHTTPClient()</span><br><span class="line">        resp = <span class="keyword">await</span> http_client.fetch(url)</span><br><span class="line">        <span class="built_in">print</span>(resp.body)</span><br><span class="line">        <span class="keyword">return</span> resp.body</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_app</span>():</span><br><span class="line">    <span class="keyword">return</span> tornado.web.Application([</span><br><span class="line">        (<span class="string">r&quot;/api&quot;</span>, APIHandler),</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = make_app()</span><br><span class="line">    app.listen(<span class="number">8888</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure>
<p>gevnet：</p>
<ul>
<li>基于轻量级绿色线程(greenlet)实现并发</li>
<li>需要注意 monkey patch，gevent 修改了内置的socket改为非阻塞</li>
<li>配合 gunicorn 和 gevent 部署作为 wsgi server</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent.monkey</span><br><span class="line">gevent.monkey.patch_all()  <span class="comment"># 修改内置的一些库非阻塞</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch</span>(<span class="params">i</span>):</span><br><span class="line">    url = <span class="string">&#x27;http://httpbin.org/get&#x27;</span></span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(resp.text), i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asynchronous</span>():</span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">        threads.append(gevent.spawn(fetch, i))</span><br><span class="line">    gevent.joinall(threads)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Asynchronous:&#x27;</span>)</span><br><span class="line">asynchronous()</span><br></pre></td></tr></table></figure>
<p>asyncio：</p>
<ul>
<li>基于协程实现的内置并发网络库，协程+时间循环</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于 aiohttp 并发请求</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> aiohttp <span class="keyword">import</span> ClientSession   <span class="comment"># pip install aiohttp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch</span>(<span class="params">url, session</span>):</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> response.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">r=<span class="number">10</span></span>):</span><br><span class="line">    url = <span class="string">&quot;http://httpbin.org/get&quot;</span></span><br><span class="line">    tasks = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r):</span><br><span class="line">            task = asyncio.ensure_future(fetch(url, session))</span><br><span class="line">            tasks.append(task)</span><br><span class="line">        responses = <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line">        <span class="keyword">for</span> resp_body <span class="keyword">in</span> responses:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">len</span>(resp_body))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">future = asyncio.ensure_future(run())</span><br><span class="line">loop.run_until_complete(future)</span><br></pre></td></tr></table></figure>
<h2 id="数据库相关"><a href="#数据库相关" class="headerlink" title="数据库相关"></a>数据库相关</h2><h3 id="MySQL基础"><a href="#MySQL基础" class="headerlink" title="MySQL基础"></a>MySQL基础</h3><p>事务：</p>
<ul>
<li>事务是数据库并发控制的基本单位 </li>
<li>事务可以看作是一系列SQL语句的集合</li>
<li>事务必须要么全部执行成功，要么全部执行失败（回滚） </li>
</ul>
<p>Transaction示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLAalchemy  事务回滚</span></span><br><span class="line"></span><br><span class="line">session.begin()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    item1 = session.query(Item).get(<span class="number">1</span>)</span><br><span class="line">    item2 = session.query(Item).get(<span class="number">2</span>)</span><br><span class="line">    item1.foo = <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">    item2.bar = <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">    session.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    session.rollback()</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<p>事务ACID特性：</p>
<ul>
<li>原子性(Atomicity)：一个事务中所有操作全部完成或失败</li>
<li>一致性(Consistency): 事务开始和结束之后数据完整性没有被破坏</li>
<li>隔离性(Isolation): 允许多个事务同时对数据库修改和读写 </li>
<li>持久性(Durability)：事务结束之后，修改是永久的不会丢失</li>
</ul>
<p>事务的并发控制可能产生的问题：</p>
<ul>
<li>幻读(phantom read):一个事务第二次查出现第一次没有的结果</li>
<li>非重复读(nonrepeatable read):一个事务重复读两次得到不同结果 </li>
<li>脏读(dirty read):一个事务读取到另一个事务没有提交的修改 </li>
<li>丢失修改(lost update): 并发写入造成其中一些修改丢失 </li>
</ul>
<p>四种事务隔离级别：为了解决并发控制异常，定义了4种事务隔离级别</p>
<ul>
<li>读未提交(read uncommitted):别的事务可以读取到未提交改变</li>
<li>读已提交(read committed):只能读取已经提交的数据 </li>
<li>可重复读(repeatable read):同一个事务先后查询结果一样   MySQL默认是这个</li>
<li>串行化(Serializable): 事务完全串行化的执行，隔离级别最高，执行效率最低 </li>
</ul>
<p>如何解决高并发场景下的插入重复：</p>
<p>高并发场景下，写入数据库会有数据重复问题</p>
<ul>
<li>使用数据库的唯一索引 </li>
<li>使用队列异步写入</li>
<li>使用 redis 等实现分布式锁</li>
</ul>
<p>乐观锁和悲观锁：</p>
<ul>
<li>悲观锁是先获取锁再进行操作。一锁二查三更新 select for update</li>
<li>乐观锁先修改,更新的时候发现数据已经变了就回滚(check and set)</li>
<li>使用需要根据响应速度、冲突频率、重试代价来判断使用哪一种</li>
</ul>
<p>MySQL引擎</p>
<ul>
<li>MyISAM不支持事务 ，InnoDB支持事务</li>
<li>MyISAM不支持外键，InnoDB支持外键</li>
<li>MyISAM只支持表锁，InnoDB支持行锁和表锁</li>
</ul>
<h3 id="MySQL索引"><a href="#MySQL索引" class="headerlink" title="MySQL索引"></a>MySQL索引</h3><p>什么是索引：</p>
<ul>
<li>索引是数据表中一个或者多个列进行排序的数据结构 </li>
<li>索引能够大幅提升检索速度</li>
<li>创建、更新索引本身也会耗费空间和时间 </li>
</ul>
<p>演示数据结构的网站</p>
<p><a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/Algorithms.html">https://www.cs.usfca.edu/~galles/visualization/Algorithms.html</a></p>
<p>查找结构进化史：</p>
<ul>
<li>线性查询：一个个找，实现简单；但是查找太慢</li>
<li>二分查找：需要的是有序的数组，实现比较简单；因为是有序的，插入会特别慢</li>
<li>哈希：查询快；但是占用空间(底层是利用冗余的数组来存储的)，不太适合存储大规模数据</li>
<li>二叉查找树：插入和查询很快（复杂度log(n)）；但是无法存储大规模数据， 会复杂度退化</li>
<li>平衡树：解决二叉查找树退化的问题，树是平衡的；缺点就是节点非常多的时候，树高会很高</li>
<li>多路查找树：解决平衡树 树高的问题，一个父亲多个孩子节点；节点过多树高不会特别深</li>
<li>多路平衡查找树：B-Tree 每个节点最多 m(m&gt;=2)个孩子,称为m 阶或者度<ul>
<li>叶节点具有相同的深度</li>
<li>节点中的数据 key 从左到右是递增的</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308111653.png" alt=""></p>
<p>b树  进行范围查找比较困难</p>
<p>B+Tree：</p>
<ul>
<li>B+树是B-Tree的变形</li>
<li>Mysql 实际使用的 B+Tree作为索引的数据结构</li>
<li>只在叶子节点带有指向记录的指针 (为什么？可以增加树的度)<ul>
<li>B树的每个结点都存储了key和data，B+树的data存储在叶子节点上。<br>节点不存储data，这样一个节点就可以存储更多的key。可以使得树更矮，所以IO操作次数更少</li>
<li>不是阶越大就越好。硬盘是以块来存储的，阶是由磁盘块的大小来确定的。为了让操作系统更好的读取和缓存数据，以磁盘块的大小来确定B+树的阶</li>
</ul>
</li>
<li>叶子结点通过指针相连。为什么？实现范围查询 </li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308112320.png" alt=""></p>
<p>MySQL索引类型：</p>
<ul>
<li>普通索引 (CREATE INDEX)</li>
<li>唯一索引，索引列的值必须唯一 (CREATE UNIQUE INDEX)</li>
<li>多列索引 </li>
<li>主键索引 (PRIMARY KEY)，一个表只能有一个</li>
<li>全文索引（FULLTEXT INDEX)，InnoDB 不支持</li>
</ul>
<p>什么时候创建索引：</p>
<ul>
<li>经常用作查询条件的字段(WHERE条件) </li>
<li>经常用作表连接的字段</li>
<li>经常出现在 order by, group by 之后的字段</li>
</ul>
<p>MySQL索引最佳实践：</p>
<ul>
<li>非空字段 NOT NULL，Mysql 很难对空值作查询优化</li>
<li>区分度高，离散度大（如枚举字段，就几个值，没必要创建索引），作为索引的字段值尽量不要有大量相同值</li>
<li>索引的长度不要太长(比较耗费时间) </li>
</ul>
<p>索引什么时候失效：</p>
<ul>
<li>以 % 开头的 LIKE 语句，模糊搜索</li>
<li>出现隐式类型转换，类型不匹配</li>
<li>没有满足最左前缀原则</li>
</ul>
<p>聚集索引和非聚集索引：</p>
<ul>
<li>聚集还是非聚集指的是B+Tree 叶节点存的是指针还是数据记录</li>
<li>MyISAM索引和数据分离，使用的是非聚集索引</li>
<li>InnoDB数据文件就是索引文件，主键索引就是聚集索引 </li>
</ul>
<p>非聚集索引：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308113702.png" alt=""></p>
<p>聚集索引：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308113746.png" alt=""></p>
<p>排查慢查询：</p>
<ul>
<li>慢查询通常是缺少索引，索引不合理或者业务代码实现导致</li>
<li>slow_query_log_file 开启并且查询慢查询日志 </li>
<li>通过 explain 排查索引问题</li>
<li>调整数据修改索引；业务代码层限制不合理访问</li>
</ul>
<h3 id="缓存机制和Redis"><a href="#缓存机制和Redis" class="headerlink" title="缓存机制和Redis"></a>缓存机制和Redis</h3><p>什么是缓存？为什么要使用缓存？</p>
<ul>
<li>缓解关系数据库(常见的是Mysql)并发访问的压力：热点数据 </li>
<li>减少响应时间：内存 IO 速度比磁盘快</li>
<li>提升吞吐量：Redis 等内存数据库单机就可以支撑很大并发 </li>
</ul>
<p>Redis和Memcached的区别：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308115352.png" alt=""></p>
<p>Redis常用数据类型和使用场景：</p>
<ul>
<li>String(字符串):用来实现简单的 KV 键值对存储，比如计数器</li>
<li>List(链表):实现双向链表，比如用户的关注，粉丝列表</li>
<li>Hash(哈希表): 用来存储彼此相关信息的键值对 </li>
<li>Set(集合): 存储不重复元素，比如用户的关注者</li>
<li>Sorted Set(有序集合): 实时信息排行榜 </li>
</ul>
<p>Redis的底层实现：</p>
<ul>
<li>String: 整数或者sds(Simple Dynamic String)</li>
<li>List: ziplist或者double linked list<ul>
<li>ziplist(压缩列表) 通过一个连续的内存块实现list结构，其中的每个entry节点头部保存前后节点长度信息，实现双向链表功能。</li>
</ul>
</li>
<li>Hash: ziplist 或者 hashtable（哈希表） </li>
<li>Set: intset 或者 hashtable </li>
<li>SortedSet: skiplist 跳跃表</li>
</ul>
<p>跳跃表：</p>
<p>sorted set为了简化实现，使用skiplist而不是平衡树实现</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308120115.png" alt=""></p>
<p>Redis持久化方式：</p>
<ul>
<li>RDB 快照方式：把数据快照放在磁盘二进制文件中，dump.rdb，在指定时间间隔把Redis数据库状态保存到一个压缩的二级制文件中<ul>
<li>相当于记录一个一个时间段的快照，可以很好的恢复到某个时间段的版本</li>
<li>在某个时间段内，数据库宕机了，很有可能会丢失整个时间间隔之内的数据。</li>
</ul>
</li>
<li>AOF(Append Only File)：每一个写命令追加到 appendonly.aof中<ul>
<li>缺点就是每个文件会比较大</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/madashu/p/12832766.html">https://www.cnblogs.com/madashu/p/12832766.html</a></p>
<p>Redis事务：</p>
<ul>
<li>将多个请求打包，一次性、按序执行多个命令的机制</li>
<li>Redis 通过 MULTI, EXEC, WATCH 等命令实现事务功能</li>
<li>Python redis.py  pipeline=conn.pipeline(transaction=True) </li>
<li>redis原子性不支持回滚；一致性需要使用watch来监听key，如果修改的话就是执行失败；隔离性，redis单线程的，本身支持；持久性，RDB和AOF并不能严格的保证持久化。</li>
</ul>
<p>Redis如何实现分布式锁：</p>
<ul>
<li>使用setnx实现加锁，可以同时通过expire添加超时时间</li>
<li>锁的 value 值可以使用一个随机的 uuid 或者特定的命名</li>
<li>释放锁的时候，通过uuid 判断是否是该锁，是则执行delete释放锁 </li>
</ul>
<p>常用的缓存使用模式：</p>
<ul>
<li>Cache Aside: 同时更新缓存和数据库 </li>
<li>Read/Write Through: 先更新缓存，缓存负责同步更新数据库</li>
<li>Write Behind Caching: 先更新缓存，缓存定期异步更新数据库 </li>
</ul>
<p>数据库与缓存之间的数据一致性：</p>
<ul>
<li>先更新数据库后更新缓存，并发操作可能导致缓存读取的是脏数据</li>
<li>一般先更新数据库然后删除缓存，下次读取的时候再重建缓存</li>
</ul>
<p><strong>缓存穿透</strong>：</p>
<ul>
<li><strong>大量查询不到的数据的请求落到后端数据库，数据库压力增大</strong>，如爬虫按照自增id爬取数据，很多id数据库都没有。</li>
<li>由于大量缓存查不到就去数据库取，数据库也没有要查的数据</li>
<li>解决：<ul>
<li>对于没查到返回为 None 的数据也缓存</li>
<li>插入数据的时候删除相应缓存，或者设置较短的超时时间 </li>
</ul>
</li>
</ul>
<p><strong>缓存击穿</strong>：</p>
<ul>
<li>某些非常热点的数据 key过期，大量请求打到后端数据库</li>
<li>热点数据 key 失效导致大量请求打到数据库增加数据库压力</li>
<li>解决：<ul>
<li>分布式锁：获取锁的线程从数据库拉数据更新缓存，其他线程等待</li>
<li>异步后台更新：后台任务针对过期的 key 自动刷新 </li>
</ul>
</li>
</ul>
<p><strong>缓存雪崩</strong>：</p>
<ul>
<li>缓存不可用或者大量缓存key同时失效，大量请求直接打到数据库</li>
<li>解决：<ul>
<li>多级缓存：不同级别的 key 设置不同的超时时间</li>
<li>随机超时：key 的超时时间随机设置，防止同时超时</li>
<li>架构层：提升系统可用性。监控、报警完善</li>
</ul>
</li>
</ul>
<h2 id="python-web框架"><a href="#python-web框架" class="headerlink" title="python web框架"></a>python web框架</h2><h3 id="WSGI："><a href="#WSGI：" class="headerlink" title="WSGI："></a>WSGI：</h3><ul>
<li>Python Web Server Gateway Interface (pep3333)，在web server和web应用之间提供一个标准的接口，从而让web应用部署在任意的web server上</li>
<li>解决 Python Web Server 乱象 mod_python, CGI, FastCGI 等</li>
<li>描述了Web Server(Gunicorn/uWSGI)如何与 web 框架(Flask/Django)交互，Web 框架如何处理请求</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># WSGI定义</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">application</span>(<span class="params">environ, start_response</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># application就是WSGI app，一个可调用对象</span></span><br><span class="line"><span class="comment"># environ参数：一个包含WSGI环境信息的字典，由WSGI服务器提供，常见的key有PATH_INFO，QUERY_STRING等</span></span><br><span class="line"><span class="comment"># start_response: 生成WSGI响应的回调函数，接收两个参数，status和headers</span></span><br><span class="line"><span class="comment"># 函数返回响应体的可迭代对象</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>编写一个兼容WSGI的web应用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">myapp</span>(<span class="params">environ, start_response</span>):</span><br><span class="line">    <span class="built_in">print</span>(environ[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">    status = <span class="string">&#x27;200 OK&#x27;</span></span><br><span class="line">    headers = [(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf8&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">    start_response(status, headers)</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b&#x27;&lt;h1&gt;Hello World&lt;/h1&gt;&#x27;</span>]  <span class="comment"># 可迭代对象，返回 字节</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line">    httpd = make_server(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8888</span>, myapp)</span><br><span class="line">    httpd.serve_forever()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>封装成类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, routers, **kwargs</span>):</span><br><span class="line">        self.routers = routers</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, environ, start_response</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            request = Request(environ)</span><br><span class="line">            callback, args = routers.<span class="keyword">match</span>(request.path)</span><br><span class="line">            response = callback(request, *args)</span><br><span class="line">        <span class="keyword">except</span> NotFoundError:</span><br><span class="line">            response = Response(<span class="string">&quot;&lt;h1&gt;Not found&lt;/h1&gt;&quot;</span>, status=<span class="number">404</span>)</span><br><span class="line">        start_response(response.status, response.headers.items())</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>(response)</span><br></pre></td></tr></table></figure>
<h3 id="常见的python-web-框架"><a href="#常见的python-web-框架" class="headerlink" title="常见的python web 框架"></a>常见的python web 框架</h3><ul>
<li>Django: 大而全，内置 ORM、Admin 等组件，第三方插件较多 </li>
<li>Flask:微框架，插件机制，比较灵活</li>
<li>Tornado:异步支持的微框架和异步网络库</li>
</ul>
<p>MVC：</p>
<ul>
<li>Model: 负责业务对象和数据库的交互(ORM) </li>
<li>View：负责与用户的交互展示</li>
<li>Controller：接收请求参数调用模型和视图完成请求</li>
</ul>
<p>Web 框架一般有哪些组件：</p>
<ul>
<li>中间件，用于请求之前和请求之后做一些处理（比如记录日志等）</li>
<li>路由, 表单验证, 权限认证, ORM, 视图函数, 模板渲染, 序列化 </li>
<li>第三方插件：Redis连接，RESTful支持等</li>
</ul>
<p>Gunicorn: Python WSGI HTTP Server</p>
<ul>
<li>纯 Python 编写的高性能的 WSGI Server</li>
<li>pre-fork 预先分配多个 worker 进程处理请求(master-slave) </li>
<li>多种 worker 支持：Sync/Async(Gevent)/Tornado/AsyncIO</li>
<li><code>gunicorn -w 4 myapp:app</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308130114.png" alt=""></p>
<h3 id="常见的web-安全问题"><a href="#常见的web-安全问题" class="headerlink" title="常见的web 安全问题"></a>常见的web 安全问题</h3><ul>
<li>SQL注入</li>
<li>XSS(跨站脚本攻击, Cross-Site Scripting)</li>
<li>CSRF(跨站请求伪造, Cross-site request forgery)</li>
</ul>
<h4 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h4><ul>
<li>通过构造特殊的输入参数传入Web应用，导致后端执行了恶意 SQL</li>
<li>u通常由于程序员未对输入进行过滤，直接动态拼接 SQL 产生</li>
<li>可以使用开源工具 sqlmap, SQLninja 检测</li>
</ul>
<p>防范 SQL 注入：</p>
<ul>
<li>对输入参数做好检查（类型和范围）；过滤和转义特殊字符</li>
<li>不要直接拼接 sql，使用 ORM 可以大大降低 sql 注入风险</li>
<li>数据库层：做好权限管理配置；不要明文存储敏感信息</li>
</ul>
<h4 id="XSS跨站脚本攻击"><a href="#XSS跨站脚本攻击" class="headerlink" title="XSS跨站脚本攻击"></a>XSS跨站脚本攻击</h4><ul>
<li>恶意用户将代码植入到提供给其他用户使用的页面中，未经转义的恶意代码输出到其他用户的浏览器被执行</li>
<li>用户浏览页面的时候嵌入页面中的脚本(js)会被执行，攻击用户</li>
<li>主要分为两类：反射型(非持久型)，存储型(持久型)</li>
</ul>
<p>XSS的危害：</p>
<ul>
<li>盗用用户 cookie，获取敏感信息</li>
<li>利用用户私人账号执行一些违法操作，比如盗取个人或者商业资料，执行一些隐私操作</li>
<li>甚至可以在一些访问量很大的网站上实现DDoS 攻击</li>
</ul>
<p>如何防范XSS：</p>
<ul>
<li>过滤(输入和参数)。对敏感标签 <code>&lt;script&gt; &lt;img&gt; &lt;a&gt;</code>等进行过滤</li>
<li>转义。对常见符号(“&amp;”, “&lt;” and “&gt;)转义（python3 html.escape)</li>
<li>设置HttpOnly 禁止浏览器访问和操作 Document.cookie</li>
</ul>
<h4 id="CSRF跨站请求伪造"><a href="#CSRF跨站请求伪造" class="headerlink" title="CSRF跨站请求伪造"></a>CSRF跨站请求伪造</h4><ul>
<li>利用网站对已认证用户的权限去执行未授权的命令的一种恶意攻击</li>
<li>攻击者会盗用你的登录信息，以你的身份模拟发送请求</li>
<li>web 身份认证机制只能识别一个请求是否来自某个用户的浏览器，但是无法保证请求是用户自己或者批准发送的</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/setcreed/CDN@latest/img/20210308131733.png" alt=""></p>
<p>CSRF产生的条件：</p>
<ul>
<li>受害者已经登录到了目标网站并且没有退出(保持登录状态)</li>
<li>受害者访问了攻击者发布的链接或者表单</li>
<li>二者必须缺一不可</li>
</ul>
<p>如何防范CSRF：<strong>不要在</strong> <strong>GET</strong> <strong>请求里有任何数据修改操作</strong></p>
<ul>
<li>令牌同步(Synchronizer token pattern，简称STP)：在用户请求的表单中嵌入一个隐藏的csrf_token，服务端验证其是否与 cookie 中的一致（基于同源策略其他网站是无法获取cookie中的csrf_token)</li>
<li>如果是 js 提交需要先从cookie获取csrf_token作为 X-CSRFToken请求头提交提交</li>
<li>其他：检测来源HTTP Referer(容易被伪造)；验证码方式(安全但是繁琐)</li>
</ul>
<h3 id="前后端分离与-RESTful"><a href="#前后端分离与-RESTful" class="headerlink" title="前后端分离与 RESTful"></a>前后端分离与 RESTful</h3><p>什么是前后端分离：</p>
<ul>
<li>后端只负责提供数据接口，不再渲染模板，前端获取数据并呈现</li>
<li>前后端解耦，接口复用（前端和客户端公用接口），减少开发量</li>
<li>各司其职，前后端同步开发，提升工作效率。定义好接口规范</li>
<li>更有利于调试(mock)、测试和运维部署</li>
</ul>
<p>什么是RESTful：Representational State Transfer</p>
<ul>
<li>表现层状态转移，由 HTTP 协议的主要设计者Roy Fielding提出 </li>
<li>资源(Resources)，表现层(Representation)，状态转化(State Transfer)<ul>
<li>Resources(资源): 使用 URI 指向的一个实体</li>
<li>Representation(表现层): 资源的表现形式，比如图片、HTML 文本等</li>
<li>State Transfer(状态转化): GET、POST、PUT、DELETE HTTP 动词来操作资源，实现资源状态的改变</li>
</ul>
</li>
<li>是一种以资源为中心的 web软件架构风格，可以用 Ajax 和 RESTful web服务构建应用</li>
</ul>
<p>RESTful的准则：</p>
<ul>
<li>所有事物抽象为资源(resource)，资源对应唯一的标识(identifier) </li>
<li>资源通过接口进行操作实现状态转移，操作本身是无状态的</li>
<li>对资源的操作不会改变资源的标识</li>
</ul>
<p>RESTful 风格的 API 接口：</p>
<ul>
<li>通过 HTTP GET/POST/PUT/DELETE  获取/新建/更新/删除 资源 </li>
<li>一般使用 JSON 格式返回数据</li>
</ul>
<p>如何设计RESTful风格的API：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>HTTP方法</th>
<th>URL</th>
<th>动作</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><a href="http://[hostname]/api/users">http://[hostname]/api/users</a></td>
<td>检索用户列表</td>
</tr>
<tr>
<td>GET</td>
<td><a href="http://[hostname]/api/users/[user_id">http://[hostname]/api/users/[user_id</a>]</td>
<td>检索单个用户</td>
</tr>
<tr>
<td>POST</td>
<td><a href="http://[hostname]/api/users">http://[hostname]/api/users</a></td>
<td>创建新用户</td>
</tr>
<tr>
<td>PUT</td>
<td><a href="http://[hostname]/api/users/[user_id">http://[hostname]/api/users/[user_id</a>]</td>
<td>更新用户信息</td>
</tr>
<tr>
<td>DELETE</td>
<td><a href="http://[hostname]/api/users/[user_id">http://[hostname]/api/users/[user_id</a>]</td>
<td>删除用户</td>
</tr>
</tbody>
</table>
</div>
<p>使用tornado实现RESTful API：</p>
<p>user_handler.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">from</span> tornado.escape <span class="keyword">import</span> json_encode</span><br><span class="line"><span class="keyword">from</span> models.user <span class="keyword">import</span> UserModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserListHandler</span>(tornado.web.RequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self</span>):   <span class="comment"># 批量获取用户</span></span><br><span class="line">        users = UserModel.get_all()</span><br><span class="line">        self.write(json_encode(users))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self</span>):</span><br><span class="line">        name = self.get_argument(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        age = self.get_argument(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">        UserModel.create(name, age)</span><br><span class="line">        resp = &#123;<span class="string">&#x27;status&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;create success&#x27;</span>&#125;</span><br><span class="line">        self.write(json_encode(resp))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserHandler</span>(tornado.web.RequestHandler):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, user_id</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user = UserModel.get(<span class="built_in">int</span>(user_id))</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">return</span> self.set_status(<span class="number">404</span>)</span><br><span class="line">        self.write(json_encode(user))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, user_id</span>):</span><br><span class="line">        age = self.get_argument(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">        UserModel.update(<span class="built_in">int</span>(user_id), age)</span><br><span class="line">        resp = &#123;<span class="string">&#x27;status&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;update success&#x27;</span>&#125;</span><br><span class="line">        self.write(json_encode(resp))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, user_id</span>):</span><br><span class="line">        UserModel.delete(<span class="built_in">int</span>(user_id))</span><br><span class="line">        resp = &#123;<span class="string">&#x27;status&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;delete success&#x27;</span>&#125;</span><br><span class="line">        self.write(json_encode(resp))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>user_model.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserModel</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    users = &#123;</span><br><span class="line">        <span class="number">1</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;zhang&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">10</span>&#125;,</span><br><span class="line">        <span class="number">2</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;wang&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">12</span>&#125;,</span><br><span class="line">        <span class="number">3</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">20</span>&#125;,</span><br><span class="line">        <span class="number">4</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;zhao&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">30</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">cls, user_id</span>):</span><br><span class="line">        <span class="keyword">return</span> cls.users[user_id]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_all</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>(cls.users.values())</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">cls, name, age</span>):</span><br><span class="line">        user_dict = &#123;<span class="string">&#x27;name&#x27;</span>: name, <span class="string">&#x27;age&#x27;</span>: age&#125;</span><br><span class="line">        max_id = <span class="built_in">max</span>(cls.users.keys()) + <span class="number">1</span></span><br><span class="line">        cls.users[max_id] = user_dict</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">cls, user_id, age</span>):</span><br><span class="line">        cls.users[user_id][<span class="string">&#x27;age&#x27;</span>] = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">cls, user_id</span>):</span><br><span class="line">        <span class="keyword">if</span> user_id <span class="keyword">in</span> cls.users:</span><br><span class="line">            <span class="keyword">return</span> cls.users.pop(user_id)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h2><p>什么是系统设计：</p>
<ul>
<li>是一个定义系统架构、模块、接口和数据满足特定需求的过程</li>
<li>比如一个短网址服务、评论服务、Feed流系统、抢红包系统</li>
<li>微服务架构很多系统被按照业务拆分，需要单独设计一个系统服务</li>
</ul>
<p>系统设计的要素：</p>
<ul>
<li>使用场景和限制条件<ul>
<li>这个系统是在什么地方使用的？比如短网址系统提供给站内各种服务生成短网址</li>
<li>限制条件：用户多少？至少要能支撑多少服务</li>
<li>估算并发qps：峰值qps是多少？平均qps是多少？</li>
</ul>
</li>
<li>数据存储设计，数据库选型<ul>
<li>按需设计数据表，需要哪些字段，使用什么类型？数据的增长规模是怎样的</li>
<li>数据库选型：是否需要持久化？使用关系型还是NoSQL？</li>
<li>如何优化？如何设计索引？是否可以使用缓存？</li>
</ul>
</li>
<li>算法模块设计，算法是解决问题的核心。程序=算法+数据结构。系统=服务+存储<ul>
<li>需要哪些接口？接口如何设计</li>
<li>使用什么算法或者模型？</li>
<li>不同实现方式之间的优劣对比，如何取舍？</li>
</ul>
</li>
</ul>
<h3 id="短网址系统的设计和实现"><a href="#短网址系统的设计和实现" class="headerlink" title="短网址系统的设计和实现"></a>短网址系统的设计和实现</h3><p>如何设计和实现一个短网址系统？</p>
<ul>
<li>什么是短网址系统？包含哪些功能？</li>
<li>短网址系统的存储设计？需要存储哪些字段</li>
<li>如何设计算法生成短网址？</li>
</ul>
<p>什么是短网址系统：</p>
<ul>
<li>把长网址转换成短网址的服务</li>
<li>比如 <a target="_blank" rel="noopener" href="https://bitly.com/">https://bitly.com/</a></li>
<li>转换之后的网址后缀不超过7位</li>
</ul>
<p>场景和限制：</p>
<ul>
<li>场景：提供短网址服务为公司其他个业务服务</li>
<li>功能：一个长网址转成短网址并存储；根据短网址还原长网址</li>
<li>要求短网址的后缀不超过7位</li>
<li>预估峰值插入请求数量级：数百；查询请求数量级：数千</li>
</ul>
<p>数据存储设计：</p>
<ul>
<li><p>使用MySQL</p>
</li>
<li><p>字段</p>
<ul>
<li>id</li>
<li>token 存储短网址生成的token，给token加入索引</li>
<li>url（原来的网址）</li>
<li>created_time</li>
</ul>
</li>
</ul>
<p>算法实现设计</p>
<ul>
<li>两个API：long2short_url，short2long_url</li>
</ul>
<p>短网址生成算法：</p>
<ul>
<li>md5摘要算法，取出前7个字符。但是会有冲突</li>
<li>26个小写字母+26个大写字母+10个数字 ，26+26+10=62<ul>
<li>类似于62进制的数字</li>
<li>十进制-&gt;62进制，可以类比10进制-&gt;2进制</li>
<li>递增序列算法</li>
</ul>
</li>
<li>自增id 需要一个计数器 使用Redis的 incr</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python实现10进制到2进制的转化</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mybin</span>(<span class="params">num</span>):  <span class="comment"># 10进制-&gt;2进制串</span></span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">while</span> num:</span><br><span class="line">        num, rem = <span class="built_in">divmod</span>(num, <span class="number">2</span>)</span><br><span class="line">        res.append(<span class="built_in">str</span>(rem))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">reversed</span>(res))</span><br><span class="line"></span><br><span class="line">CHARS = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> CHARS[<span class="number">0</span>]</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">while</span> num:</span><br><span class="line">        num, rem = <span class="built_in">divmod</span>(num, <span class="built_in">len</span>(CHARS))  <span class="comment"># 62</span></span><br><span class="line">        res.append(CHARS[rem])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">reversed</span>(res))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(encode(<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(encode(<span class="number">61</span>))</span><br></pre></td></tr></table></figure>
<p>实现：</p>
<p>创建的数据库表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE short_url (</span><br><span class="line">  id bigint unsigned NOT NULL AUTO_INCREMENT,</span><br><span class="line">  token varchar(10),</span><br><span class="line">  url varchar(2048),</span><br><span class="line">  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `idx_token` (`token`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>short_url_app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">短网址生成代码。Flask 演示</span></span><br><span class="line"><span class="string">依赖本地 mysql 和 redis</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, render_template, request</span><br><span class="line"><span class="keyword">from</span> flask_mysqldb <span class="keyword">import</span> MySQL</span><br><span class="line"><span class="keyword">from</span> flask.ext.redis <span class="keyword">import</span> FlaskRedis</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_USER&#x27;</span>] = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_PASSWORD&#x27;</span>] = os.getenv(<span class="string">&#x27;MYSQL_PASS&#x27;</span>) <span class="comment"># export your password</span></span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_DB&#x27;</span>] = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_CURSORCLASS&#x27;</span>] = <span class="string">&#x27;DictCursor&#x27;</span></span><br><span class="line"></span><br><span class="line">mysql = MySQL(app)</span><br><span class="line">redis_store = FlaskRedis(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CHARS = <span class="string">&quot;abcdefghijkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ0123456789&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> CHARS[<span class="number">0</span>]</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">while</span> num:</span><br><span class="line">        num, rem = <span class="built_in">divmod</span>(num, <span class="built_in">len</span>(CHARS))  <span class="comment"># 62</span></span><br><span class="line">        res.append(CHARS[rem])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">reversed</span>(res))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shorten&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shorten_url</span>():</span><br><span class="line">    long_url = request.json[<span class="string">&#x27;url&#x27;</span>]</span><br><span class="line">    index = <span class="built_in">int</span>(redis_store.incr(<span class="string">&#x27;SHORT_CNT&#x27;</span>))</span><br><span class="line">    token = encode(index)</span><br><span class="line">    sql = <span class="string">&quot;INSERT INTO short_url(token, url) VALUES(%s, %s)&quot;</span></span><br><span class="line">    cur = mysql.connection.cursor()</span><br><span class="line">    cur.execute(sql, (token, long_url))</span><br><span class="line">    mysql.connection.commit()</span><br><span class="line">    short_url = <span class="string">&#x27;https://short.com/&#x27;</span> + token</span><br><span class="line">    <span class="keyword">return</span> jsonify(url=short_url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>templates/index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>短网址服务<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/jquery/3.1.0/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">stylesheet</span> <span class="attr">type</span>=<span class="string">text/css</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/custom.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"> $(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">     $(<span class="string">&#x27;#submitButton&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">         $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">url</span>: <span class="string">&quot;/shorten&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="string">&#x27;url&#x27;</span> : $(<span class="string">&#x27;#url&#x27;</span>).<span class="title function_">val</span>()&#125;),</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">success</span>: returnSuccess,</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">         &#125;);</span></span><br><span class="line"><span class="language-javascript">     &#125;);</span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">returnSuccess</span>(<span class="params">data, textStatus, jqXHR</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span>(data.<span class="property">url</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#url-result&#x27;</span>).<span class="title function_">text</span>(data.<span class="property">url</span>);</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#url&#x27;</span>).<span class="title function_">val</span>(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;a&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;href&quot;</span>, data.<span class="property">url</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#url-result&#x27;</span>).<span class="title function_">text</span>(<span class="string">&quot;请输入一个URL!&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>短网址服务<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>请输入一个网址<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col s12&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">id</span>=<span class="string">&quot;url&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control input-sm&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入一个合法的网址&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col s4 offset-s4&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;submitButton&quot;</span> <span class="attr">class</span>=<span class="string">&quot;waves-effect waves-light btn-large blue darken-1&quot;</span>&gt;</span>生成<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col s12&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-footer&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">h4</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">id</span>=<span class="string">&quot;url-result&quot;</span>&gt;</span>输入 URL<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 短网址服务，前端代码参考 aiohttp demo --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>static/css/custom.css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#content</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">60px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">header</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#wrap</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">5px</span> <span class="number">10px</span> -<span class="number">50px</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#url-result</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#039be5</span>;</span><br><span class="line">    <span class="attribute">display</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">footer</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#039be5</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">footer</span> <span class="selector-tag">a</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#039be5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://setcreed.github.io">SetCreed</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://setcreed.github.io/posts/69b95a22/">https://setcreed.github.io/posts/69b95a22/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://setcreed.github.io" target="_blank">伊甸园</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://setcreed.oss-cn-shanghai.aliyuncs.com/images/material-1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.com/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://unpkg.com/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/c092dbc6/" title="python核心"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://setcreed.oss-cn-shanghai.aliyuncs.com/images/material-1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">python核心</div></div></a></div><div class="next-post pull-right"><a href="/posts/9d5d35e/" title="celery简单使用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://setcreed.oss-cn-shanghai.aliyuncs.com/images/material-3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">celery简单使用</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">SetCreed</div><div class="author-info__description">读书、写代码、看电影</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">89</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">27</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/setcreed"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="/img/qq.jpg" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="/img/wechat_account.jpg" target="_blank" title="微信"><i class="fab fa-weixin"></i></a><a class="social-icon" href="https://github.com/setcreed" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:cwzdzg@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Python%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">Python语言基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#python%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7"><span class="toc-number">1.1.</span> <span class="toc-text">python语言特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">鸭子类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python2%E4%B8%8E3%E7%9A%84%E5%B7%AE%E5%BC%82"><span class="toc-number">1.3.</span> <span class="toc-text">python2与3的差异</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#monkey-patch"><span class="toc-number">1.4.</span> <span class="toc-text">monkey patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E7%9C%81Introspection"><span class="toc-number">1.5.</span> <span class="toc-text">自省Introspection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python%E5%87%BD%E6%95%B0"><span class="toc-number">1.6.</span> <span class="toc-text">python函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">python异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python%E6%80%A7%E8%83%BD"><span class="toc-number">1.8.</span> <span class="toc-text">python性能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E4%B8%8E%E5%8D%8F%E7%A8%8B"><span class="toc-number">1.9.</span> <span class="toc-text">生成器与协程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">python数据结构与算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%86%85%E7%BD%AE%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">常用的内置算法与数据结构：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-dict%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.</span> <span class="toc-text">python dict底层结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E5%B8%B8%E8%80%83%E7%AE%97%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">python常考算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F"><span class="toc-number">3.1.</span> <span class="toc-text">快速排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F"><span class="toc-number">3.2.</span> <span class="toc-text">归并排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E6%8E%92%E5%BA%8F"><span class="toc-number">3.3.</span> <span class="toc-text">堆排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE"><span class="toc-number">3.4.</span> <span class="toc-text">二分查找</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E5%B8%B8%E8%80%83%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">4.</span> <span class="toc-text">python常考数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%A1%A8"><span class="toc-number">4.1.</span> <span class="toc-text">链表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%9F%E5%88%97"><span class="toc-number">4.2.</span> <span class="toc-text">队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%88"><span class="toc-number">4.3.</span> <span class="toc-text">栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E5%85%B8%E5%92%8C%E9%9B%86%E5%90%88"><span class="toc-number">4.4.</span> <span class="toc-text">字典和集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%8F%89%E6%A0%91"><span class="toc-number">4.5.</span> <span class="toc-text">二叉树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86"><span class="toc-number">4.6.</span> <span class="toc-text">堆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">4.7.</span> <span class="toc-text">字符串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.</span> <span class="toc-text">python面向对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">5.1.</span> <span class="toc-text">装饰器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">常见的设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%88%9B%E5%BB%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%9A"><span class="toc-number">5.2.1.</span> <span class="toc-text">常见创建型设计模式：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%BB%93%E6%9E%84%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.2.</span> <span class="toc-text">常见结构型设计模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E8%A1%8C%E4%B8%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.3.</span> <span class="toc-text">常见行为型设计模式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="toc-number">6.</span> <span class="toc-text">函数式编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3"><span class="toc-number">7.</span> <span class="toc-text">操作系统相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4"><span class="toc-number">7.1.</span> <span class="toc-text">Linux常见命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B"><span class="toc-number">7.2.</span> <span class="toc-text">操作系统线程和进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6"><span class="toc-number">7.3.</span> <span class="toc-text">操作系统内存管理机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#python%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6"><span class="toc-number">7.3.1.</span> <span class="toc-text">python的垃圾回收机制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="toc-number">8.</span> <span class="toc-text">网络编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AETCP%E5%92%8CUDP"><span class="toc-number">8.1.</span> <span class="toc-text">网络协议TCP和UDP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%8D%8F%E8%AE%AE"><span class="toc-number">8.2.</span> <span class="toc-text">HTTP协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-socket%E7%BC%96%E7%A8%8B"><span class="toc-number">8.3.</span> <span class="toc-text">TCP socket编程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8"><span class="toc-number">8.4.</span> <span class="toc-text">IO多路复用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python%E5%B9%B6%E5%8F%91%E7%BD%91%E7%BB%9C%E5%BA%93%EF%BC%9A"><span class="toc-number">8.5.</span> <span class="toc-text">Python并发网络库：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3"><span class="toc-number">9.</span> <span class="toc-text">数据库相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E5%9F%BA%E7%A1%80"><span class="toc-number">9.1.</span> <span class="toc-text">MySQL基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E7%B4%A2%E5%BC%95"><span class="toc-number">9.2.</span> <span class="toc-text">MySQL索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E5%92%8CRedis"><span class="toc-number">9.3.</span> <span class="toc-text">缓存机制和Redis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python-web%E6%A1%86%E6%9E%B6"><span class="toc-number">10.</span> <span class="toc-text">python web框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WSGI%EF%BC%9A"><span class="toc-number">10.1.</span> <span class="toc-text">WSGI：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84python-web-%E6%A1%86%E6%9E%B6"><span class="toc-number">10.2.</span> <span class="toc-text">常见的python web 框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84web-%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">10.3.</span> <span class="toc-text">常见的web 安全问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">10.3.1.</span> <span class="toc-text">SQL注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB"><span class="toc-number">10.3.2.</span> <span class="toc-text">XSS跨站脚本攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSRF%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"><span class="toc-number">10.3.3.</span> <span class="toc-text">CSRF跨站请求伪造</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E4%B8%8E-RESTful"><span class="toc-number">10.4.</span> <span class="toc-text">前后端分离与 RESTful</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1"><span class="toc-number">11.</span> <span class="toc-text">系统设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0"><span class="toc-number">11.1.</span> <span class="toc-text">短网址系统的设计和实现</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/4f91bd66/" title="kube-apiserver更改鉴权方式"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://setcreed.oss-cn-shanghai.aliyuncs.com/images/material-13.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kube-apiserver更改鉴权方式"/></a><div class="content"><a class="title" href="/posts/4f91bd66/" title="kube-apiserver更改鉴权方式">kube-apiserver更改鉴权方式</a><time datetime="2024-02-27T14:17:38.000Z" title="发表于 2024-02-27 22:17:38">2024-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/fec34943/" title="kube-apiserver本地启动"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://setcreed.oss-cn-shanghai.aliyuncs.com/images/material-14.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kube-apiserver本地启动"/></a><div class="content"><a class="title" href="/posts/fec34943/" title="kube-apiserver本地启动">kube-apiserver本地启动</a><time datetime="2024-02-27T12:44:47.000Z" title="发表于 2024-02-27 20:44:47">2024-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7b5f308e/" title="kubernetes组件之apiserver"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://setcreed.oss-cn-shanghai.aliyuncs.com/images/202402272048351.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kubernetes组件之apiserver"/></a><div class="content"><a class="title" href="/posts/7b5f308e/" title="kubernetes组件之apiserver">kubernetes组件之apiserver</a><time datetime="2024-02-27T12:36:09.000Z" title="发表于 2024-02-27 20:36:09">2024-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d99f2ea2/" title="云原生软件开发模式"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://setcreed.oss-cn-shanghai.aliyuncs.com/images/material-3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云原生软件开发模式"/></a><div class="content"><a class="title" href="/posts/d99f2ea2/" title="云原生软件开发模式">云原生软件开发模式</a><time datetime="2023-11-25T14:31:18.000Z" title="发表于 2023-11-25 22:31:18">2023-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b43710ac/" title="容器共享进程命名空间的应用"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://setcreed.oss-cn-shanghai.aliyuncs.com/images/material-12.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="容器共享进程命名空间的应用"/></a><div class="content"><a class="title" href="/posts/b43710ac/" title="容器共享进程命名空间的应用">容器共享进程命名空间的应用</a><time datetime="2023-11-22T22:39:35.000Z" title="发表于 2023-11-23 06:39:35">2023-11-23</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By SetCreed</div><div class="footer_custom_text"><p><a style="margin-inline:5px" target="_blank" href="https://hexo.io/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为 Hexo" alt="HEXO"></a><a style="margin-inline:5px" target="_blank" href="https://butterfly.js.org/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用 Butterfly" alt="Butterfly"></a><a style="margin-inline:5px" target="_blank" href="https://github.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由 GitHub 托管" alt="GitHub"></a><a style="margin-inline:5px" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="https://unpkg.com/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://unpkg.com/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>